---
title: 'Effect Dependency рж╕рж░рж╛ржирзЛ'
---

<Intro>

ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ Effect рж▓рж┐ржЦрзЗржи, linter ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗ ржпрзЗ ржЖржкржирж┐ ржкрзНрж░рждрж┐ржЯрж┐ reactive value (ржпрзЗржоржи props ржПржмржВ state) ржпрж╛ Effect ржкржбрж╝рзЗ рждрж╛ ржЖржкржирж╛рж░ Effect ржПрж░ dependency ржПрж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржХрж░рзЗржЫрзЗржиред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржЖржкржирж╛рж░ Effect ржЖржкржирж╛рж░ ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ рж╕рж░рзНржмрж╢рзЗрж╖ props ржПржмржВ state ржПрж░ рж╕рж╛ржерзЗ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬржб ржерж╛ржХрзЗред ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ dependency ржЖржкржирж╛рж░ Effect ржХрзЗ ржЦрзБржм ржШржи ржШржи ржЪрж╛рж▓рзБ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, ржПржоржиржХрж┐ ржПржХржЯрж┐ infinite loop рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржЖржкржирж╛рж░ Effect ржерзЗржХрзЗ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ dependency ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ ржПржмржВ рж╕рж░рж╛рждрзЗ ржПржЗ ржЧрж╛ржЗржб ржЕржирзБрж╕рж░ржг ржХрж░рзБржиред

</Intro>

<YouWillLearn>

- ржХрж┐ржнрж╛ржмрзЗ infinite Effect dependency loop ржарж┐ржХ ржХрж░ржмрзЗржи
- ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ dependency рж╕рж░рж╛рждрзЗ ржЪрж╛ржи рждржЦржи ржХрж┐ ржХрж░рждрзЗ рж╣ржмрзЗ
- ржХрж┐ржнрж╛ржмрзЗ ржЖржкржирж╛рж░ Effect ржерзЗржХрзЗ ржПржХржЯрж┐ ржорж╛ржи ржкржбрж╝ржмрзЗржи ржПржЯрж┐рж░ ржкрзНрж░рждрж┐ "react" ржирж╛ ржХрж░рзЗ
- ржХрж┐ржнрж╛ржмрзЗ ржПржмржВ ржХрзЗржи object ржПржмржВ function dependency ржПржбрж╝рж╛рждрзЗ рж╣ржмрзЗ
- ржХрзЗржи dependency linter suppress ржХрж░рж╛ ржмрж┐ржкржЬрзНржЬржиржХ, ржПржмржВ ржкрж░рж┐ржмрж░рзНрждрзЗ ржХрж┐ ржХрж░рждрзЗ рж╣ржмрзЗ

</YouWillLearn>

## Dependency ржХрзЛржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рждрзЗ рж╣ржмрзЗ {/*dependencies-should-match-the-code*/}

ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ Effect рж▓рж┐ржЦрзЗржи, ржЖржкржирж┐ ржкрзНрж░ржержорзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗржи ржХрж┐ржнрж╛ржмрзЗ [start ржПржмржВ stop](/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect) ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржжрж┐ржпрж╝рзЗ ржХрж░рждрзЗ ржЪрж╛ржи:

```js {5-7}
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  	// ...
}
```

рждрж╛рж░ржкрж░, ржпржжрж┐ ржЖржкржирж┐ Effect dependency ржЦрж╛рж▓рж┐ (`[]`) рж░рж╛ржЦрзЗржи, linter рж╕ржарж┐ржХ dependency рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░ржмрзЗ:

<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []); // <-- Fix the mistake here!
  return <h1>Welcome to the {roomId} room!</h1>;
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input { display: block; margin-bottom: 20px; }
button { margin-left: 10px; }
```

</Sandpack>

linter ржпрж╛ ржмрж▓рзЗ рж╕рзЗржЗ ржЕржирзБржпрж╛ржпрж╝рзА рж╕рзЗржЧрзБрж▓рж┐ ржкрзВрж░ржг ржХрж░рзБржи:

```js {6}
function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
}
```

[Effect "react" ржХрж░рзЗ reactive value ржПрж░ ржкрзНрж░рждрж┐ред](/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values) ржпрзЗрж╣рзЗрждрзБ `roomId` ржПржХржЯрж┐ reactive value (ржПржЯрж┐ ржПржХржЯрж┐ re-render ржПрж░ ржХрж╛рж░ржгрзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ), linter ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ ржпрзЗ ржЖржкржирж┐ ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗржЫрзЗржиред ржпржжрж┐ `roomId` ржПржХржЯрж┐ ржнрж┐ржирзНржи ржорж╛ржи ржкрж╛ржпрж╝, React ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░ржмрзЗред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ chat ржирж┐рж░рзНржмрж╛ржЪрж┐ржд room ржПрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНржд ржерж╛ржХрзЗ ржПржмржВ dropdown ржПрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзЗ:


<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);
  return <h1>Welcome to the {roomId} room!</h1>;
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input { display: block; margin-bottom: 20px; }
button { margin-left: 10px; }
```

</Sandpack>

### ржПржХржЯрж┐ dependency рж╕рж░рж╛рждрзЗ, ржкрзНрж░ржорж╛ржг ржХрж░рзБржи ржпрзЗ ржПржЯрж┐ ржПржХржЯрж┐ dependency ржиржпрж╝ {/*to-remove-a-dependency-prove-that-its-not-a-dependency*/}

рж▓ржХрзНрж╖рзНржп ржХрж░рзБржи ржпрзЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ dependency "ржмрзЗржЫрзЗ ржирж┐рждрзЗ" ржкрж╛рж░ржмрзЗржи ржирж╛ред ржЖржкржирж╛рж░ Effect ржПрж░ ржХрзЛржб ржжрзНржмрж╛рж░рж╛ ржмрзНржпржмрж╣рзГржд ржкрзНрж░рждрж┐ржЯрж┐ <CodeStep step={2}>reactive value</CodeStep> ржЕржмрж╢рзНржпржЗ ржЖржкржирж╛рж░ dependency рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред dependency рждрж╛рж▓рж┐ржХрж╛ ржЖрж╢рзЗржкрж╛рж╢рзЗрж░ ржХрзЛржб ржжрзНржмрж╛рж░рж╛ ржирж┐рж░рзНржзрж╛рж░рж┐ржд рж╣ржпрж╝:

```js [[2, 3, "roomId"], [2, 5, "roomId"], [2, 8, "roomId"]]
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) { // ржПржЯрж┐ ржПржХржЯрж┐ reactive value
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // ржПржЗ Effect рж╕рзЗржЗ reactive value ржкржбрж╝рзЗ
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рждрж╛ржЗ ржЖржкржирж╛ржХрзЗ ржЕржмрж╢рзНржпржЗ рж╕рзЗржЗ reactive value ржЯрж┐ ржЖржкржирж╛рж░ Effect ржПрж░ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рждрзЗ рж╣ржмрзЗ
  // ...
}
```

[Reactive value](/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive) ржПрж░ ржоржзрзНржпрзЗ рж░ржпрж╝рзЗржЫрзЗ props ржПржмржВ рж╕ржорж╕рзНржд variable ржПржмржВ function ржпрж╛ рж╕рж░рж╛рж╕рж░рж┐ ржЖржкржирж╛рж░ ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ ржнрж┐рждрж░рзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржпрзЗрж╣рзЗрждрзБ `roomId` ржПржХржЯрж┐ reactive value, ржЖржкржирж┐ ржПржЯрж┐ dependency рждрж╛рж▓рж┐ржХрж╛ ржерзЗржХрзЗ рж╕рж░рж╛рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ред linter ржПржЯрж┐ ржЕржирзБржорждрж┐ ржжрзЗржмрзЗ ржирж╛:

```js {8}
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []); // ЁЯФ┤ React Hook useEffect has a missing dependency: 'roomId'
  // ...
}
```

ржПржмржВ linter рж╕ржарж┐ржХ рж╣ржмрзЗ! ржпрзЗрж╣рзЗрждрзБ `roomId` рж╕ржоржпрж╝рзЗрж░ рж╕рж╛ржерзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ, ржПржЯрж┐ ржЖржкржирж╛рж░ ржХрзЛржбрзЗ ржПржХржЯрж┐ bug introduce ржХрж░ржмрзЗред

**ржПржХржЯрж┐ dependency рж╕рж░рж╛рждрзЗ, linter ржХрзЗ "ржкрзНрж░ржорж╛ржг" ржХрж░рзБржи ржпрзЗ ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣ржУржпрж╝рж╛рж░ *ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ*ред** ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржЖржкржирж┐ `roomId` ржХрзЗ ржЖржкржирж╛рж░ ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ ржмрж╛ржЗрж░рзЗ рж╕рж░рж╛рждрзЗ ржкрж╛рж░рзЗржи ржПржЯрж┐ ржкрзНрж░ржорж╛ржг ржХрж░рждрзЗ ржпрзЗ ржПржЯрж┐ reactive ржиржпрж╝ ржПржмржВ re-render ржП ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржмрзЗ ржирж╛:

```js {2,9}
const serverUrl = 'https://localhost:1234';
const roomId = 'music'; // ржЖрж░ reactive value ржиржпрж╝

function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
}
```

ржПржЦржи ржпрзЗрж╣рзЗрждрзБ `roomId` ржПржХржЯрж┐ reactive value ржиржпрж╝ (ржПржмржВ re-render ржП ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ ржирж╛), ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ:

<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';
const roomId = 'music';

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>Welcome to the {roomId} room!</h1>;
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input { display: block; margin-bottom: 20px; }
button { margin-left: 10px; }
```

</Sandpack>

ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржЖржкржирж┐ ржПржЦржи ржПржХржЯрж┐ [ржЦрж╛рж▓рж┐ (`[]`) dependency рждрж╛рж▓рж┐ржХрж╛](/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means) ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржЖржкржирж╛рж░ Effect *рж╕рждрзНржпрж┐ржЗ* ржЖрж░ ржХрзЛржирзЛ reactive value ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржирж╛, рждрж╛ржЗ ржПржЯрж┐ *рж╕рждрзНржпрж┐ржЗ* ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ ржпржЦржи ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ ржХрзЛржирзЛ props ржмрж╛ state ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝ред

### Dependency ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ, ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи {/*to-change-the-dependencies-change-the-code*/}

ржЖржкржирж┐ рж╣ржпрж╝рждрзЛ ржЖржкржирж╛рж░ workflow ржП ржПржХржЯрж┐ pattern рж▓ржХрзНрж╖рзНржп ржХрж░рзЗржЫрзЗржи:

1. ржкрзНрж░ржержорзЗ, ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ **ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗржи** ржмрж╛ ржЖржкржирж╛рж░ reactive value ржХрж┐ржнрж╛ржмрзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ рждрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗржиред
2. рждрж╛рж░ржкрж░, ржЖржкржирж┐ linter ржЕржирзБрж╕рж░ржг ржХрж░рзЗржи ржПржмржВ **ржЖржкржирж╛рж░ ржкрж░рж┐ржмрж░рзНрждрж┐ржд ржХрзЛржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рж╛ржирзЛрж░ ржЬржирзНржп** dependency рж╕рж╛ржоржЮрзНржЬрж╕рзНржп ржХрж░рзЗржиред
3. ржпржжрж┐ ржЖржкржирж┐ dependency ржПрж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ рж╕ржирзНрждрзБрж╖рзНржЯ ржирж╛ рж╣ржи, ржЖржкржирж┐ **ржкрзНрж░ржержо ржзрж╛ржкрзЗ ржлрж┐рж░рзЗ ржпрж╛ржи** (ржПржмржВ ржЖржмрж╛рж░ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗржи)ред

рж╢рзЗрж╖ ржЕржВрж╢ржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред **ржпржжрж┐ ржЖржкржирж┐ dependency ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржЪрж╛ржи, ржкрзНрж░ржержорзЗ ржЖрж╢рзЗржкрж╛рж╢рзЗрж░ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред** ржЖржкржирж┐ dependency рждрж╛рж▓рж┐ржХрж╛ржХрзЗ [ржЖржкржирж╛рж░ Effect ржПрж░ ржХрзЛржб ржжрзНржмрж╛рж░рж╛ ржмрзНржпржмрж╣рзГржд рж╕ржорж╕рзНржд reactive value ржПрж░ ржПржХржЯрж┐ рждрж╛рж▓рж┐ржХрж╛](/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency) рж╣рж┐рж╕рж╛ржмрзЗ ржнрж╛ржмрждрзЗ ржкрж╛рж░рзЗржиред ржЖржкржирж┐ рж╕рзЗржЗ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржХрж┐ рж░рж╛ржЦржмрзЗржи рждрж╛ *ржмрзЗржЫрзЗ ржирзЗржи ржирж╛*ред рждрж╛рж▓рж┐ржХрж╛ржЯрж┐ ржЖржкржирж╛рж░ ржХрзЛржб *ржмрж░рзНржгржирж╛* ржХрж░рзЗред dependency рждрж╛рж▓рж┐ржХрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ, ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред

ржПржЯрж┐ ржПржХржЯрж┐ equation рж╕ржорж╛ржзрж╛ржи ржХрж░рж╛рж░ ржорждрзЛ ржоржирзЗ рж╣рждрзЗ ржкрж╛рж░рзЗред ржЖржкржирж┐ ржПржХржЯрж┐ рж▓ржХрзНрж╖рзНржп ржирж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи (ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржПржХржЯрж┐ dependency рж╕рж░рж╛рждрзЗ), ржПржмржВ ржЖржкржирж╛ржХрзЗ рж╕рзЗржЗ рж▓ржХрзНрж╖рзНржпрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рзЗ ржПржоржи ржХрзЛржб "ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рждрзЗ" рж╣ржмрзЗред рж╕ржмрж╛ржЗ equation рж╕ржорж╛ржзрж╛ржи ржХрж░рж╛ ржоржЬрж╛ржжрж╛рж░ ржоржирзЗ ржХрж░рзЗ ржирж╛, ржПржмржВ Effect рж▓рзЗржЦрж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗржУ ржПржХржЗ ржХржерж╛ ржмрж▓рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗ! рж╕рзМржнрж╛ржЧрзНржпржмрж╢ржд, ржирж┐ржЪрзЗ рж╕рж╛ржзрж╛рж░ржг recipe ржПрж░ ржПржХржЯрж┐ рждрж╛рж▓рж┐ржХрж╛ рж░ржпрж╝рзЗржЫрзЗ ржпрж╛ ржЖржкржирж┐ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

<Pitfall>

ржпржжрж┐ ржЖржкржирж╛рж░ ржПржХржЯрж┐ ржмрж┐ржжрзНржпржорж╛ржи codebase ржерж╛ржХрзЗ, ржЖржкржирж╛рж░ ржХрж┐ржЫрзБ Effect ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ ржпрж╛ ржПржЗржнрж╛ржмрзЗ linter suppress ржХрж░рзЗ:

```js {3-4}
useEffect(() => {
  // ...
  // ЁЯФ┤ ржПржЗржнрж╛ржмрзЗ linter suppress ржХрж░рж╛ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи:
  // eslint-ignore-next-line react-hooks/exhaustive-deps
}, []);
```

**ржпржЦржи dependency ржХрзЛржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рзЗ ржирж╛, рждржЦржи bug introduce ржХрж░рж╛рж░ ржЦрзБржм ржмрзЗрж╢рж┐ ржЭрзБржБржХрж┐ ржерж╛ржХрзЗред** linter suppress ржХрж░рзЗ, ржЖржкржирж┐ React ржХрзЗ ржЖржкржирж╛рж░ Effect ржпрзЗ value ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ рж╕рзЗ рж╕ржорзНржкрж░рзНржХрзЗ "ржорж┐ржерзНржпрж╛ ржмрж▓рзЗржи"ред

ржкрж░рж┐ржмрж░рзНрждрзЗ, ржирж┐ржЪрзЗрж░ ржХрзМрж╢рж▓ржЧрзБрж▓рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

</Pitfall>

<DeepDive>

#### ржХрзЗржи dependency linter suppress ржХрж░рж╛ ржПржд ржмрж┐ржкржЬрзНржЬржиржХ? {/*why-is-suppressing-the-dependency-linter-so-dangerous*/}

linter suppress ржХрж░рж╛ ржЦрзБржм unintuitive bug ржПрж░ ржжрж┐ржХрзЗ ржирж┐ржпрж╝рзЗ ржпрж╛ржпрж╝ ржпрж╛ ржЦрзБржБржЬрзЗ ржкрж╛ржУржпрж╝рж╛ ржПржмржВ ржарж┐ржХ ржХрж░рж╛ ржХржарж┐ржиред ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ ржЙржжрж╛рж╣рж░ржг:

<Sandpack>

```js
import { useState, useEffect } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  function onTick() {
	setCount(count + increment);
  }

  useEffect(() => {
    const id = setInterval(onTick, 1000);
    return () => clearInterval(id);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Every second, increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>тАУ</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
    </>
  );
}
```

```css
button { margin: 10px; }
```

</Sandpack>

ржзрж░рж╛ ржпрж╛ржХ ржЖржкржирж┐ Effect ржЯрж┐ "рж╢рзБржзрзБржорж╛рждрзНрж░ mount ржП" ржЪрж╛рж▓рж╛рждрзЗ ржЪрзЗржпрж╝рзЗржЫрж┐рж▓рзЗржиред ржЖржкржирж┐ ржкржбрж╝рзЗржЫрзЗржи ржпрзЗ [ржЦрж╛рж▓рж┐ (`[]`) dependency](/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means) ржПржЯрж┐ ржХрж░рзЗ, рждрж╛ржЗ ржЖржкржирж┐ linter ржЙржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛рж░ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирж┐ржпрж╝рзЗржЫрзЗржи, ржПржмржВ ржЬрзЛрж░ ржХрж░рзЗ `[]` dependency рж╣рж┐рж╕рж╛ржмрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзЗржЫрзЗржиред

ржПржЗ counter ржЯрж┐ ржжрзБржЯрж┐ button ржжрж┐ржпрж╝рзЗ configurable ржкрж░рж┐ржорж╛ржг ржжрзНржмрж╛рж░рж╛ ржкрзНрж░рждрж┐ рж╕рзЗржХрзЗржирзНржбрзЗ ржмрзГржжрзНржзрж┐ ржкрж╛ржУржпрж╝рж╛рж░ ржХржерж╛ ржЫрж┐рж▓ред рждржмрзЗ, ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж┐ React ржХрзЗ "ржорж┐ржерзНржпрж╛ ржмрж▓рзЗржЫрзЗржи" ржпрзЗ ржПржЗ Effect ржХрж┐ржЫрзБрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржирж╛, React ржЪрж┐рж░ржХрж╛рж▓ initial render ржерзЗржХрзЗ `onTick` function ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржерж╛ржХрзЗред [рж╕рзЗржЗ render ржПрж░ рж╕ржоржпрж╝,](/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time) `count` ржЫрж┐рж▓ `0` ржПржмржВ `increment` ржЫрж┐рж▓ `1`ред ржПржЗ ржХрж╛рж░ржгрзЗржЗ рж╕рзЗржЗ render ржерзЗржХрзЗ `onTick` рж╕рж░рзНржмржжрж╛ ржкрзНрж░рждрж┐ рж╕рзЗржХрзЗржирзНржбрзЗ `setCount(0 + 1)` ржХрж▓ ржХрж░рзЗ, ржПржмржВ ржЖржкржирж┐ рж╕рж░рзНржмржжрж╛ `1` ржжрзЗржЦрзЗржиред ржПржЗ ржзрж░ржирзЗрж░ bug ржарж┐ржХ ржХрж░рж╛ ржЖрж░ржУ ржХржарж┐ржи ржпржЦржи рждрж╛рж░рж╛ ржПржХрж╛ржзрж┐ржХ ржХржорзНржкрзЛржирзЗржирзНржЯ ржЬрзБржбрж╝рзЗ ржЫржбрж╝рж┐ржпрж╝рзЗ ржерж╛ржХрзЗред

linter ржЙржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛рж░ ржЪрзЗржпрж╝рзЗ рж╕рж░рзНржмржжрж╛ ржПржХржЯрж┐ ржнрж╛рж▓рзЛ рж╕ржорж╛ржзрж╛ржи ржЖржЫрзЗ! ржПржЗ ржХрзЛржб ржарж┐ржХ ржХрж░рждрзЗ, ржЖржкржирж╛ржХрзЗ dependency рждрж╛рж▓рж┐ржХрж╛ржпрж╝ `onTick` ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗред (interval рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржмрж╛рж░ setup рж╣ржпрж╝ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ, [`onTick` ржХрзЗ ржПржХржЯрж┐ Effect Event ржХрж░рзБржиред](/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events))

**ржЖржорж░рж╛ dependency lint error ржХрзЗ ржПржХржЯрж┐ compilation error рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛рж░ рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж┐ред ржпржжрж┐ ржЖржкржирж┐ ржПржЯрж┐ suppress ржирж╛ ржХрж░рзЗржи, ржЖржкржирж┐ ржХржЦржиржУ ржПржЗ ржзрж░ржирзЗрж░ bug ржжрзЗржЦржмрзЗржи ржирж╛ред** ржПржЗ ржкрзГрж╖рзНржарж╛рж░ ржмрж╛ржХрж┐ ржЕржВрж╢ ржПржЗ ржПржмржВ ржЕржирзНржпрж╛ржирзНржп ржХрзНрж╖рзЗрждрзНрж░рзЗ ржмрж┐ржХрж▓рзНржкржЧрзБрж▓рж┐ ржиржерж┐ржнрзБржХрзНржд ржХрж░рзЗред

</DeepDive>

## ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ dependency рж╕рж░рж╛ржирзЛ {/*removing-unnecessary-dependencies*/}

ржкрзНрж░рждрж┐ржмрж╛рж░ ржпржЦржи ржЖржкржирж┐ ржХрзЛржб ржкрзНрж░рждрж┐ржлрж▓рж┐ржд ржХрж░рждрзЗ Effect ржПрж░ dependency рж╕рж╛ржоржЮрзНржЬрж╕рзНржп ржХрж░рзЗржи, dependency рждрж╛рж▓рж┐ржХрж╛рж░ ржжрж┐ржХрзЗ рждрж╛ржХрж╛ржиред ржПржЗ dependency ржЧрзБрж▓рж┐рж░ ржпрзЗржХрзЛржирзЛ ржПржХржЯрж┐ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рж▓рзЗ Effect ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржУржпрж╝рж╛ ржХрж┐ ржмрзЛржзржЧржорзНржп? ржХржЦржиржУ ржХржЦржиржУ, ржЙрждрзНрждрж░ рж╣рж▓ "ржирж╛":

* ржЖржкржирж┐ ржмрж┐ржнрж┐ржирзНржи рж╢рж░рзНрждрзЗ ржЖржкржирж╛рж░ Effect ржПрж░ *ржмрж┐ржнрж┐ржирзНржи ржЕржВрж╢* ржкрзБржирж░рж╛ржпрж╝ execute ржХрж░рждрзЗ ржЪрж╛ржЗрждрзЗ ржкрж╛рж░рзЗржиред
* ржЖржкржирж┐ ржХрж┐ржЫрзБ dependency ржПрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ рждрж╛рж░ *рж╕рж░рзНржмрж╢рзЗрж╖ ржорж╛ржи* ржкржбрж╝рждрзЗ ржЪрж╛ржЗрждрзЗ ржкрж╛рж░рзЗржиред
* ржПржХржЯрж┐ dependency *ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ* ржЦрзБржм ржШржи ржШржи ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ ржХрж╛рж░ржг ржПржЯрж┐ ржПржХржЯрж┐ object ржмрж╛ ржПржХржЯрж┐ functionред

рж╕ржарж┐ржХ рж╕ржорж╛ржзрж╛ржи ржЦрзБржБржЬрзЗ ржкрзЗрждрзЗ, ржЖржкржирж╛ржХрзЗ ржЖржкржирж╛рж░ Effect рж╕ржорзНржкрж░рзНржХрзЗ ржХржпрж╝рзЗржХржЯрж┐ ржкрзНрж░рж╢рзНржирзЗрж░ ржЙрждрзНрждрж░ ржжрж┐рждрзЗ рж╣ржмрзЗред ржЖрж╕рзБржи рждрж╛ржжрзЗрж░ ржоржзрзНржп ржжрж┐ржпрж╝рзЗ ржпрж╛ржЗред

### ржПржЗ ржХрзЛржб ржХрж┐ ржПржХржЯрж┐ event handler ржП рж╕рж░рж╛ржирзЛ ржЙржЪрж┐ржд? {/*should-this-code-move-to-an-event-handler*/}

ржЖржкржирж╛рж░ ржкрзНрж░ржержо ржпрзЗ ржмрж┐рж╖ржпрж╝ржЯрж┐ ржЪрж┐ржирзНрждрж╛ ржХрж░рж╛ ржЙржЪрж┐ржд рждрж╛ рж╣рж▓ ржПржЗ ржХрзЛржбржЯрж┐ ржЖржжрзМ ржПржХржЯрж┐ Effect рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржХрж┐ржирж╛ред

ржПржХржЯрж┐ form ржХрж▓рзНржкржирж╛ ржХрж░рзБржиред submit ржП, ржЖржкржирж┐ `submitted` state variable `true` рждрзЗ set ржХрж░рзЗржиред ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ POST request ржкрж╛ржарж╛рждрзЗ рж╣ржмрзЗ ржПржмржВ ржПржХржЯрж┐ notification ржжрзЗржЦрж╛рждрзЗ рж╣ржмрзЗред ржЖржкржирж┐ ржПржЗ logic ржПржХржЯрж┐ Effect ржПрж░ ржнрж┐рждрж░рзЗ рж░рзЗржЦрзЗржЫрзЗржи ржпрж╛ `submitted` `true` рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзЗ:

```js {6-8}
function Form() {
  const [submitted, setSubmitted] = useState(false);

  useEffect(() => {
    if (submitted) {
      // ЁЯФ┤ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи: Event-specific logic ржПржХржЯрж┐ Effect ржПрж░ ржнрж┐рждрж░рзЗ
      post('/api/register');
      showNotification('Successfully registered!');
    }
  }, [submitted]);

  function handleSubmit() {
    setSubmitted(true);
  }

  // ...
}
```

ржкрж░рзЗ, ржЖржкржирж┐ ржмрж░рзНрждржорж╛ржи theme ржЕржирзБржпрж╛ржпрж╝рзА notification message style ржХрж░рждрзЗ ржЪрж╛ржи, рждрж╛ржЗ ржЖржкржирж┐ ржмрж░рзНрждржорж╛ржи theme ржкржбрж╝рзЗржиред ржпрзЗрж╣рзЗрждрзБ `theme` component body рждрзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржПржЯрж┐ ржПржХржЯрж┐ reactive value, рждрж╛ржЗ ржЖржкржирж┐ ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржпрзЛржЧ ржХрж░рзЗржи:

```js {3,9,11}
function Form() {
  const [submitted, setSubmitted] = useState(false);
  const theme = useContext(ThemeContext);

  useEffect(() => {
    if (submitted) {
      // ЁЯФ┤ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи: Event-specific logic ржПржХржЯрж┐ Effect ржПрж░ ржнрж┐рждрж░рзЗ
      post('/api/register');
      showNotification('Successfully registered!', theme);
    }
  }, [submitted, theme]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

  function handleSubmit() {
    setSubmitted(true);
  }  

  // ...
}
```

ржПржЯрж┐ ржХрж░рзЗ, ржЖржкржирж┐ ржПржХржЯрж┐ bug introduce ржХрж░рзЗржЫрзЗржиред ржХрж▓рзНржкржирж╛ ржХрж░рзБржи ржЖржкржирж┐ ржкрзНрж░ржержорзЗ form submit ржХрж░рзЗржЫрзЗржи ржПржмржВ рждрж╛рж░ржкрж░ Dark ржПржмржВ Light theme ржПрж░ ржоржзрзНржпрзЗ switch ржХрж░рзЗржЫрзЗржиред `theme` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржмрзЗ, Effect ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржмрзЗ, ржПржмржВ ржПржЯрж┐ ржЖржмрж╛рж░ ржПржХржЗ notification ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░ржмрзЗ!

**ржПржЦрж╛ржирзЗ рж╕ржорж╕рзНржпрж╛ рж╣рж▓ ржПржЯрж┐ ржкрзНрж░ржержо рж╕рзНржерж╛ржирзЗ ржПржХржЯрж┐ Effect рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржиржпрж╝ред** ржЖржкржирж┐ ржПржЗ POST request ржкрж╛ржарж╛рждрзЗ ржПржмржВ notification ржжрзЗржЦрж╛рждрзЗ ржЪрж╛ржи *form submit ржХрж░рж╛рж░* ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛ржпрж╝, ржпрж╛ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ interactionред ржирж┐рж░рзНржжрж┐рж╖рзНржЯ interaction ржПрж░ ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛ржпрж╝ ржХрж┐ржЫрзБ ржХрзЛржб ржЪрж╛рж▓рж╛рждрзЗ, рж╕рзЗржЗ logic рж╕рж░рж╛рж╕рж░рж┐ рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ event handler ржП рж░рж╛ржЦрзБржи:

```js {6-7}
function Form() {
  const theme = useContext(ThemeContext);

  function handleSubmit() {
    // тЬЕ ржнрж╛рж▓рзЛ: Event-specific logic event handler ржерзЗржХрзЗ ржХрж▓ ржХрж░рж╛ рж╣ржпрж╝
    post('/api/register');
    showNotification('Successfully registered!', theme);
  }  

  // ...
}
```

ржПржЦржи ржпрзЗрж╣рзЗрждрзБ ржХрзЛржбржЯрж┐ ржПржХржЯрж┐ event handler ржП ржЖржЫрзЗ, ржПржЯрж┐ reactive ржиржпрж╝тАФрждрж╛ржЗ ржПржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржЪрж╛рж▓рзБ рж╣ржмрзЗ ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА form submit ржХрж░ржмрзЗред [event handler ржПржмржВ Effect ржПрж░ ржоржзрзНржпрзЗ ржмрзЗржЫрзЗ ржирзЗржУржпрж╝рж╛](/learn/separating-events-from-effects#reactive-values-and-reactive-logic) ржПржмржВ [ржХрж┐ржнрж╛ржмрзЗ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ Effect ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ рж╣ржпрж╝](/learn/you-might-not-need-an-effect) рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржкржбрж╝рзБржиред

### ржЖржкржирж╛рж░ Effect ржХрж┐ ржмрж┐ржнрж┐ржирзНржи рж╕ржорзНржкрж░рзНржХрж╣рзАржи ржХрж╛ржЬ ржХрж░ржЫрзЗ? {/*is-your-effect-doing-several-unrelated-things*/}

ржкрж░ржмрж░рзНрждрзА ржкрзНрж░рж╢рзНржи ржпрж╛ ржЖржкржирж╛рж░ ржирж┐ржЬрзЗржХрзЗ ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░рж╛ ржЙржЪрж┐ржд рждрж╛ рж╣рж▓ ржЖржкржирж╛рж░ Effect ржмрж┐ржнрж┐ржирзНржи рж╕ржорзНржкрж░рзНржХрж╣рзАржи ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ред

ржХрж▓рзНржкржирж╛ ржХрж░рзБржи ржЖржкржирж┐ ржПржХржЯрж┐ shipping form рждрзИрж░рж┐ ржХрж░ржЫрзЗржи ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рждрж╛ржжрзЗрж░ city ржПржмржВ area ржмрзЗржЫрзЗ ржирж┐рждрзЗ рж╣ржмрзЗред ржЖржкржирж┐ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд `country` ржЕржирзБржпрж╛ржпрж╝рзА server ржерзЗржХрзЗ `cities` ржПрж░ рждрж╛рж▓рж┐ржХрж╛ fetch ржХрж░рзЗржи ржПржХржЯрж┐ dropdown ржП ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп:

```js
function ShippingForm({ country }) {
  const [cities, setCities] = useState(null);
  const [city, setCity] = useState(null);

  useEffect(() => {
    let ignore = false;
    fetch(`/api/cities?country=${country}`)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setCities(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [country]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

  // ...
```

ржПржЯрж┐ [ржПржХржЯрж┐ Effect ржП data fetching](/learn/you-might-not-need-an-effect#fetching-data) ржПрж░ ржПржХржЯрж┐ ржнрж╛рж▓рзЛ ржЙржжрж╛рж╣рж░ржгред ржЖржкржирж┐ `country` prop ржЕржирзБржпрж╛ржпрж╝рзА network ржПрж░ рж╕рж╛ржерзЗ `cities` state рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░ржЫрзЗржиред ржЖржкржирж┐ ржПржЯрж┐ ржПржХржЯрж┐ event handler ржП ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ ржХрж╛рж░ржг ржЖржкржирж╛ржХрзЗ fetch ржХрж░рждрзЗ рж╣ржмрзЗ ржпржЦржиржЗ `ShippingForm` ржкрзНрж░ржжрж░рзНрж╢рж┐ржд рж╣ржпрж╝ ржПржмржВ ржпржЦржиржЗ `country` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝ (ржХрзЛржи interaction ржПржЯрж┐ ржШржЯрж╛ржпрж╝ рждрж╛ ржмрж┐ржмрзЗржЪржирж╛ ржирж╛ ржХрж░рзЗ)ред

ржПржЦржи ржзрж░рж╛ ржпрж╛ржХ ржЖржкржирж┐ city area ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ ржжрзНржмрж┐рждрзАржпрж╝ select box ржпрзЛржЧ ржХрж░ржЫрзЗржи, ржпрж╛ ржмрж░рзНрждржорж╛ржирзЗ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд `city` ржПрж░ ржЬржирзНржп `areas` fetch ржХрж░ржмрзЗред ржЖржкржирж┐ ржПржХржЗ Effect ржПрж░ ржнрж┐рждрж░рзЗ area ржПрж░ рждрж╛рж▓рж┐ржХрж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржжрзНржмрж┐рждрзАржпрж╝ `fetch` call ржпрзЛржЧ ржХрж░рзЗ рж╢рзБрж░рзБ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```js {15-24,28}
function ShippingForm({ country }) {
  const [cities, setCities] = useState(null);
  const [city, setCity] = useState(null);
  const [areas, setAreas] = useState(null);

  useEffect(() => {
    let ignore = false;
    fetch(`/api/cities?country=${country}`)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setCities(json);
        }
      });
    // ЁЯФ┤ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи: ржПржХржЯрж┐ ржПржХржХ Effect ржжрзБржЯрж┐ рж╕рзНржмрждржирзНрждрзНрж░ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рзЗ
    if (city) {
      fetch(`/api/areas?city=${city}`)
        .then(response => response.json())
        .then(json => {
          if (!ignore) {
            setAreas(json);
          }
        });
    }
    return () => {
      ignore = true;
    };
  }, [country, city]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

  // ...
```

рждржмрзЗ, ржпрзЗрж╣рзЗрждрзБ Effect ржПржЦржи `city` state variable ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ, ржЖржкржирж╛ржХрзЗ dependency ржПрж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ `city` ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржпрж╝рзЗржЫрзЗред ржПржЯрж┐, ржкрж░рж┐ржмрж░рзНрждрзЗ, ржПржХржЯрж┐ рж╕ржорж╕рзНржпрж╛ introduce ржХрж░рзЗржЫрзЗ: ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржХржЯрж┐ ржнрж┐ржирзНржи city ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗ, Effect ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржмрзЗ ржПржмржВ `fetchCities(country)` ржХрж▓ ржХрж░ржмрзЗред ржлрж▓рж╕рзНржмрж░рзВржк, ржЖржкржирж┐ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ржнрж╛ржмрзЗ city ржПрж░ рждрж╛рж▓рж┐ржХрж╛ ржЕржирзЗржХржмрж╛рж░ refetch ржХрж░ржмрзЗржиред

**ржПржЗ ржХрзЛржбрзЗрж░ рж╕ржорж╕рзНржпрж╛ рж╣рж▓ ржЖржкржирж┐ ржжрзБржЯрж┐ ржнрж┐ржирзНржи рж╕ржорзНржкрж░рзНржХрж╣рзАржи ржЬрж┐ржирж┐рж╕ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░ржЫрзЗржи:**

1. ржЖржкржирж┐ `country` prop ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ network ржПрж░ рж╕рж╛ржерзЗ `cities` state рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рждрзЗ ржЪрж╛ржиред
2. ржЖржкржирж┐ `city` state ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ network ржПрж░ рж╕рж╛ржерзЗ `areas` state рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рждрзЗ ржЪрж╛ржиред


logic ржЯрж┐ ржжрзБржЯрж┐ Effect ржП ржмрж┐ржнржХрзНржд ржХрж░рзБржи, ржпрж╛рж░ ржкрзНрж░рждрж┐ржЯрж┐ рж╕рзЗржЗ prop ржПрж░ ржкрзНрж░рждрж┐ react ржХрж░рзЗ ржпрж╛рж░ рж╕рж╛ржерзЗ ржПржЯрж┐ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рждрзЗ рж╣ржмрзЗ:

```js {19-33}
function ShippingForm({ country }) {
  const [cities, setCities] = useState(null);
  useEffect(() => {
    let ignore = false;
    fetch(`/api/cities?country=${country}`)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setCities(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [country]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

  const [city, setCity] = useState(null);
  const [areas, setAreas] = useState(null);
  useEffect(() => {
    if (city) {
      let ignore = false;
      fetch(`/api/areas?city=${city}`)
        .then(response => response.json())
        .then(json => {
          if (!ignore) {
            setAreas(json);
          }
        });
      return () => {
        ignore = true;
      };
    }
  }, [city]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

  // ...
```

ржПржЦржи ржкрзНрж░ржержо Effect рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржпрж╝ ржпржЦржи `country` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝, ржпржЦржи ржжрзНржмрж┐рждрзАржпрж╝ Effect ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржпрж╝ ржпржЦржи `city` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝ред ржЖржкржирж┐ рждрж╛ржжрзЗрж░ ржЙржжрзНржжрзЗрж╢рзНржп ржЕржирзБржпрж╛ржпрж╝рзА ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗржЫрзЗржи: ржжрзБржЯрж┐ ржнрж┐ржирзНржи ржЬрж┐ржирж┐рж╕ ржжрзБржЯрж┐ ржкрзГржержХ Effect ржжрзНржмрж╛рж░рж╛ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рж╛ рж╣ржпрж╝ред ржжрзБржЯрж┐ ржкрзГржержХ Effect ржПрж░ ржжрзБржЯрж┐ ржкрзГржержХ dependency рждрж╛рж▓рж┐ржХрж╛ ржЖржЫрзЗ, рждрж╛ржЗ рждрж╛рж░рж╛ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ ржПржХрзЗ ржЕржкрж░ржХрзЗ trigger ржХрж░ржмрзЗ ржирж╛ред

ржЪрзВржбрж╝рж╛ржирзНржд ржХрзЛржбржЯрж┐ ржорзВрж▓ ржХрзЛржбрзЗрж░ ржЪрзЗржпрж╝рзЗ ржжрзАрж░рзНржШ, ржХрж┐ржирзНрждрзБ ржПржЗ Effect ржЧрзБрж▓рж┐ ржмрж┐ржнржХрзНржд ржХрж░рж╛ ржПржЦржиржУ рж╕ржарж┐ржХред [ржкрзНрж░рждрж┐ржЯрж┐ Effect ржПржХржЯрж┐ рж╕рзНржмрждржирзНрждрзНрж░ synchronization ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржкрзНрж░рждрж┐ржирж┐ржзрж┐рждрзНржм ржХрж░рж╛ ржЙржЪрж┐рждред](/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process) ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржПржХржЯрж┐ Effect ржорзБржЫрзЗ ржлрзЗрж▓рж▓рзЗ ржЕржирзНржп Effect ржПрж░ logic ржнрж╛ржЩрзЗ ржирж╛ред ржПрж░ ржорж╛ржирзЗ рждрж╛рж░рж╛ *ржмрж┐ржнрж┐ржирзНржи ржЬрж┐ржирж┐рж╕ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рзЗ,* ржПржмржВ рждрж╛ржжрзЗрж░ ржЖрж▓рж╛ржжрж╛ ржХрж░рж╛ ржнрж╛рж▓рзЛред ржпржжрж┐ ржЖржкржирж┐ duplication ржирж┐ржпрж╝рзЗ ржЪрж┐ржирзНрждрж┐ржд рж╣ржи, ржЖржкржирж┐ [ржПржХржЯрж┐ custom Hook ржП repetitive logic extract ржХрж░рзЗ](/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks) ржПржЗ ржХрзЛржб ржЙржирзНржиржд ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### ржЖржкржирж┐ ржХрж┐ ржкрж░ржмрж░рзНрждрзА state ржЧржгржирж╛ ржХрж░рждрзЗ ржХрж┐ржЫрзБ state ржкржбрж╝ржЫрзЗржи? {/*are-you-reading-some-state-to-calculate-the-next-state*/}

ржПржЗ Effect ржкрзНрж░рждрж┐ржмрж╛рж░ ржПржХржЯрж┐ ржирждрзБржи message ржЖрж╕рж▓рзЗ ржПржХржЯрж┐ ржирждрзБржи рждрзИрж░рж┐ array ржжрж┐ржпрж╝рзЗ `messages` state variable ржЖржкржбрзЗржЯ ржХрж░рзЗ:

```js {2,6-8}
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages([...messages, receivedMessage]);
    });
    // ...
```

ржПржЯрж┐ `messages` variable ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕ржорж╕рзНржд ржмрж┐ржжрзНржпржорж╛ржи message ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рзЗ [ржПржХржЯрж┐ ржирждрзБржи array рждрзИрж░рж┐ ржХрж░рзЗ](/learn/updating-arrays-in-state) ржПржмржВ рж╢рзЗрж╖рзЗ ржирждрзБржи message ржпрзЛржЧ ржХрж░рзЗред рждржмрзЗ, ржпрзЗрж╣рзЗрждрзБ `messages` ржПржХржЯрж┐ reactive value ржпрж╛ ржПржХржЯрж┐ Effect ржжрзНржмрж╛рж░рж╛ ржкржбрж╝рж╛ рж╣ржпрж╝, ржПржЯрж┐ ржЕржмрж╢рзНржпржЗ ржПржХржЯрж┐ dependency рж╣рждрзЗ рж╣ржмрзЗ:

```js {7,10}
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages([...messages, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId, messages]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржмржВ `messages` ржХрзЗ ржПржХржЯрж┐ dependency ржХрж░рж╛ ржПржХржЯрж┐ рж╕ржорж╕рзНржпрж╛ introduce ржХрж░рзЗред

ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖржкржирж┐ ржПржХржЯрж┐ message ржкрж╛ржи, `setMessages()` ржХржорзНржкрзЛржирзЗржирзНржЯржХрзЗ ржПржХржЯрж┐ ржирждрзБржи `messages` array рж╕рж╣ re-render ржХрж░рзЗ ржпрж╛рждрзЗ ржкрзНрж░рж╛ржкрзНржд message ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржерж╛ржХрзЗред рждржмрзЗ, ржпрзЗрж╣рзЗрждрзБ ржПржЗ Effect ржПржЦржи `messages` ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ, ржПржЯрж┐ Effect ржХрзЗржУ *ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ* ржХрж░ржмрзЗред рждрж╛ржЗ ржкрзНрж░рждрж┐ржЯрж┐ ржирждрзБржи message chat ржХрзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд ржХрж░ржмрзЗред ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржЯрж┐ ржкржЫржирзНржж ржХрж░ржмрзЗ ржирж╛!

рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, Effect ржПрж░ ржнрж┐рждрж░рзЗ `messages` ржкржбрж╝ржмрзЗржи ржирж╛ред ржкрж░рж┐ржмрж░рзНрждрзЗ, `setMessages` ржП ржПржХржЯрж┐ [updater function](/reference/react/useState#updating-state-based-on-the-previous-state) ржкрж╛рж╕ ржХрж░рзБржи:

```js {7,10}
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages(msgs => [...msgs, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

**рж▓ржХрзНрж╖рзНржп ржХрж░рзБржи ржХрж┐ржнрж╛ржмрзЗ ржЖржкржирж╛рж░ Effect ржПржЦржи ржЖрж░ `messages` variable ржкржбрж╝рзЗ ржирж╛ред** ржЖржкржирж╛ржХрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржЯрж┐ updater function ржкрж╛рж╕ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрзЗржоржи `msgs => [...msgs, receivedMessage]`ред React [ржЖржкржирж╛рж░ updater function ржХрзЗ ржПржХржЯрж┐ queue ржП рж░рж╛ржЦрзЗ](/learn/queueing-a-series-of-state-updates) ржПржмржВ ржкрж░ржмрж░рзНрждрзА render ржПрж░ рж╕ржоржпрж╝ ржПржЯрж┐ржХрзЗ `msgs` argument ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗред ржПржЗ ржХрж╛рж░ржгрзЗржЗ Effect ржирж┐ржЬрзЗржЗ ржЖрж░ `messages` ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛ред ржПржЗ fix ржПрж░ ржлрж▓рзЗ, ржПржХржЯрж┐ chat message ржкрж╛ржУржпрж╝рж╛ ржЖрж░ chat ржХрзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд ржХрж░ржмрзЗ ржирж╛ред


### ржЖржкржирж┐ ржХрж┐ ржПржХржЯрж┐ ржорж╛ржи ржкржбрж╝рждрзЗ ржЪрж╛ржи ржПрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржирж╛ ржХрж░рзЗ? {/*do-you-want-to-read-a-value-without-reacting-to-its-changes*/}

<Wip>

ржПржЗ ржЕржирзБржЪрзНржЫрзЗржжржЯрж┐ ржПржХржЯрж┐ **experimental API ржмрж░рзНржгржирж╛ ржХрж░рзЗ ржпрж╛ ржПржЦржиржУ React ржПрж░ ржПржХржЯрж┐ stable version ржП release** рж╣ржпрж╝ржирж┐ред

</Wip>

ржзрж░рзБржи ржЖржкржирж┐ ржПржХржЯрж┐ sound play ржХрж░рждрзЗ ржЪрж╛ржи ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржХржЯрж┐ ржирждрзБржи message ржкрж╛ржпрж╝ ржпржжрж┐ ржирж╛ `isMuted` `true` рж╣ржпрж╝:

```js {3,10-12}
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  const [isMuted, setIsMuted] = useState(false);

  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages(msgs => [...msgs, receivedMessage]);
      if (!isMuted) {
        playSound();
      }
    });
    // ...
```

ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ Effect ржПржЦржи рждрж╛рж░ ржХрзЛржбрзЗ `isMuted` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ, ржЖржкржирж╛ржХрзЗ ржПржЯрж┐ dependency рждрзЗ ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗ:

```js {10,15}
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  const [isMuted, setIsMuted] = useState(false);

  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages(msgs => [...msgs, receivedMessage]);
      if (!isMuted) {
        playSound();
      }
    });
    return () => connection.disconnect();
  }, [roomId, isMuted]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

рж╕ржорж╕рзНржпрж╛ рж╣рж▓ ржкрзНрж░рждрж┐ржмрж╛рж░ `isMuted` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рж▓рзЗ (ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА "Muted" toggle ржЪрж╛ржкрзЗ), Effect ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ рж╣ржмрзЗ, ржПржмржВ chat ржП ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗред ржПржЯрж┐ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд user experience ржиржпрж╝! (ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржПржоржиржХрж┐ linter ржирж┐рж╖рзНржХрзНрж░рж┐ржпрж╝ ржХрж░рж╛ржУ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛--ржпржжрж┐ ржЖржкржирж┐ рждрж╛ ржХрж░рзЗржи, `isMuted` рждрж╛рж░ ржкрзБрж░рж╛ржирзЛ ржорж╛ржи ржирж┐ржпрж╝рзЗ "ржЖржЯржХрзЗ" ржпрж╛ржмрзЗред)

ржПржЗ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, ржЖржкржирж╛ржХрзЗ Effect ржерзЗржХрзЗ рж╕рзЗржЗ logic extract ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ reactive рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржиржпрж╝ред ржЖржкржирж┐ ржЪрж╛ржи ржирж╛ ржПржЗ Effect `isMuted` ржПрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзБржХред [ржПржЗ non-reactive logic ржПрж░ ржЕржВрж╢ржЯрж┐ ржПржХржЯрж┐ Effect Event ржП рж╕рж░рж╛ржи:](/learn/separating-events-from-effects#declaring-an-effect-event)

```js {1,7-12,18,21}
import { useState, useEffect, useEffectEvent } from 'react';

function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  const [isMuted, setIsMuted] = useState(false);

  const onMessage = useEffectEvent(receivedMessage => {
    setMessages(msgs => [...msgs, receivedMessage]);
    if (!isMuted) {
      playSound();
    }
  });

  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      onMessage(receivedMessage);
    });
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

Effect Event ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ Effect ржХрзЗ reactive ржЕржВрж╢рзЗ (ржпрж╛ reactive value ржпрзЗржоржи `roomId` ржПржмржВ рждрж╛ржжрзЗрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рж╛ ржЙржЪрж┐ржд) ржПржмржВ non-reactive ржЕржВрж╢рзЗ (ржпрж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ рждрж╛ржжрзЗрж░ рж╕рж░рзНржмрж╢рзЗрж╖ ржорж╛ржи ржкржбрж╝рзЗ, ржпрзЗржоржи `onMessage` `isMuted` ржкржбрж╝рзЗ) ржмрж┐ржнржХрзНржд ржХрж░рждрзЗ ржжрзЗржпрж╝ред **ржПржЦржи ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж┐ ржПржХржЯрж┐ Effect Event ржПрж░ ржнрж┐рждрж░рзЗ `isMuted` ржкржбрж╝рзЗржи, ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржПржХржЯрж┐ dependency рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред** ржлрж▓рж╕рзНржмрж░рзВржк, ржпржЦржи ржЖржкржирж┐ "Muted" setting on ржПржмржВ off toggle ржХрж░рзЗржи рждржЦржи chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗ ржирж╛, ржорзВрж▓ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржХрж░рзЗ!

#### Props ржерзЗржХрзЗ ржПржХржЯрж┐ event handler wrap ржХрж░рж╛ {/*wrapping-an-event-handler-from-the-props*/}

ржЖржкржирж┐ ржПржХржЯрж┐ ржЕржирзБрж░рзВржк рж╕ржорж╕рзНржпрж╛ржпрж╝ ржкржбрж╝рждрзЗ ржкрж╛рж░рзЗржи ржпржЦржи ржЖржкржирж╛рж░ component ржПржХржЯрж┐ event handler prop рж╣рж┐рж╕рж╛ржмрзЗ ржкрж╛ржпрж╝:

```js {1,8,11}
function ChatRoom({ roomId, onReceiveMessage }) {
  const [messages, setMessages] = useState([]);

  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      onReceiveMessage(receivedMessage);
    });
    return () => connection.disconnect();
  }, [roomId, onReceiveMessage]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржзрж░рзБржи parent component ржкрзНрж░рждрж┐ржЯрж┐ render ржП ржПржХржЯрж┐ *ржнрж┐ржирзНржи* `onReceiveMessage` function ржкрж╛рж╕ ржХрж░рзЗ:

```js {3-5}
<ChatRoom
  roomId={roomId}
  onReceiveMessage={receivedMessage => {
    // ...
  }}
/>
```

ржпрзЗрж╣рзЗрждрзБ `onReceiveMessage` ржПржХржЯрж┐ dependency, ржПржЯрж┐ ржкрзНрж░рждрж┐ржЯрж┐ parent re-render ржПрж░ ржкрж░рзЗ Effect ржХрзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░ржмрзЗред ржПржЯрж┐ chat ржП ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд ржХрж░ржмрзЗред ржПржЯрж┐ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, call ржЯрж┐ ржПржХржЯрж┐ Effect Event ржП wrap ржХрж░рзБржи:

```js {4-6,12,15}
function ChatRoom({ roomId, onReceiveMessage }) {
  const [messages, setMessages] = useState([]);

  const onMessage = useEffectEvent(receivedMessage => {
    onReceiveMessage(receivedMessage);
  });

  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      onMessage(receivedMessage);
    });
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

Effect Event reactive ржиржпрж╝, рждрж╛ржЗ ржЖржкржирж╛ржХрзЗ рждрж╛ржжрзЗрж░ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛ред ржлрж▓рж╕рзНржмрж░рзВржк, ржПржоржиржХрж┐ parent component ржкрзНрж░рждрж┐ржЯрж┐ re-render ржП ржПржХржЯрж┐ ржнрж┐ржирзНржи function ржкрж╛рж╕ ржХрж░рж▓рзЗржУ chat ржЖрж░ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗ ржирж╛ред


#### Reactive ржПржмржВ non-reactive ржХрзЛржб ржЖрж▓рж╛ржжрж╛ ржХрж░рж╛ {/*separating-reactive-and-non-reactive-code*/}

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржЖржкржирж┐ ржкрзНрж░рждрж┐ржмрж╛рж░ `roomId` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рж▓рзЗ ржПржХржЯрж┐ visit log ржХрж░рждрзЗ ржЪрж╛ржиред ржЖржкржирж┐ ржкрзНрж░рждрж┐ржЯрж┐ log ржПрж░ рж╕рж╛ржерзЗ ржмрж░рзНрждржорж╛ржи `notificationCount` ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржХрж░рждрзЗ ржЪрж╛ржи, ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ *ржЪрж╛ржи ржирж╛* `notificationCount` ржПрж░ ржкрж░рж┐ржмрж░рзНрждржи ржПржХржЯрж┐ log event trigger ржХрж░рзБржХред

рж╕ржорж╛ржзрж╛ржи ржЖржмрж╛рж░ non-reactive ржХрзЛржб ржПржХржЯрж┐ Effect Event ржП ржЖрж▓рж╛ржжрж╛ ржХрж░рж╛:

```js {2-4,7}
function Chat({ roomId, notificationCount }) {
  const onVisit = useEffectEvent(visitedRoomId => {
    logVisit(visitedRoomId, notificationCount);
  });

  useEffect(() => {
    onVisit(roomId);
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
}
```

ржЖржкржирж┐ ржЪрж╛ржи ржЖржкржирж╛рж░ logic `roomId` ржПрж░ рж╕рж╛ржкрзЗржХрзНрж╖рзЗ reactive рж╣рзЛржХ, рждрж╛ржЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ `roomId` ржкржбрж╝рзЗржиред рждржмрзЗ, ржЖржкржирж┐ ржЪрж╛ржи ржирж╛ `notificationCount` ржПрж░ ржкрж░рж┐ржмрж░рзНрждржи ржПржХржЯрж┐ ржЕрждрж┐рж░рж┐ржХрзНржд visit log ржХрж░рзБржХ, рждрж╛ржЗ ржЖржкржирж┐ Effect Event ржПрж░ ржнрж┐рждрж░рзЗ `notificationCount` ржкржбрж╝рзЗржиред [Effect Event ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Effect ржерзЗржХрзЗ рж╕рж░рзНржмрж╢рзЗрж╖ props ржПржмржВ state ржкржбрж╝рж╛ рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржЬрж╛ржирзБржиред](/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events)

### ржХрж┐ржЫрзБ reactive value ржХрж┐ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝? {/*does-some-reactive-value-change-unintentionally*/}

ржХржЦржиржУ ржХржЦржиржУ, ржЖржкржирж┐ *ржЪрж╛ржи* ржЖржкржирж╛рж░ Effect ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржорж╛ржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзБржХ, ржХрж┐ржирзНрждрзБ рж╕рзЗржЗ ржорж╛ржи ржЖржкржирж╛рж░ ржкржЫржирзНржжрзЗрж░ ржЪрзЗржпрж╝рзЗ ржмрзЗрж╢рж┐ ржШржи ржШржи ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝--ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржжрзГрж╖рзНржЯрж┐ржХрзЛржг ржерзЗржХрзЗ ржХрзЛржирзЛ ржкрзНрж░ржХрзГржд ржкрж░рж┐ржмрж░рзНрждржи ржкрзНрж░рждрж┐ржлрж▓рж┐ржд ржирж╛ржУ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржзрж░рж╛ ржпрж╛ржХ ржЖржкржирж┐ ржЖржкржирж╛рж░ component ржПрж░ body рждрзЗ ржПржХржЯрж┐ `options` object рждрзИрж░рж┐ ржХрж░рзЗржи, ржПржмржВ рждрж╛рж░ржкрж░ ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░ ржерзЗржХрзЗ рж╕рзЗржЗ object ржкржбрж╝рзЗржи:

```js {3-6,9}
function ChatRoom({ roomId }) {
  // ...
  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    // ...
```

ржПржЗ object component body рждрзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, рждрж╛ржЗ ржПржЯрж┐ ржПржХржЯрж┐ [reactive valueред](/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values) ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ Effect ржПрж░ ржнрж┐рждрж░рзЗ ржПржЗрж░ржХржо ржПржХржЯрж┐ reactive value ржкржбрж╝рзЗржи, ржЖржкржирж┐ ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рзЗржиред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржЖржкржирж╛рж░ Effect ржПрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзЗ:

```js {3,6}
  // ...
  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг! ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ, ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржпржжрж┐ `roomId` ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝, ржЖржкржирж╛рж░ Effect ржирждрзБржи `options` ржжрж┐ржпрж╝рзЗ chat ржП ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗред рждржмрзЗ, ржЙржкрж░рзЗрж░ ржХрзЛржбрзЗржУ ржПржХржЯрж┐ рж╕ржорж╕рзНржпрж╛ ржЖржЫрзЗред ржПржЯрж┐ ржжрзЗржЦрждрзЗ, ржирж┐ржЪрзЗрж░ sandbox ржП input ржП ржЯрж╛ржЗржк ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи, ржПржмржВ console ржП ржХрж┐ ржШржЯрзЗ рждрж╛ ржжрзЗржЦрзБржи:

<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  // Temporarily disable the linter to demonstrate the problem
  // eslint-disable-next-line react-hooks/exhaustive-deps
  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]);

  return (
    <>
      <h1>Welcome to the {roomId} room!</h1>
      <input value={message} onChange={e => setMessage(e.target.value)} />
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}
```

```js src/chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input { display: block; margin-bottom: 20px; }
button { margin-left: 10px; }
```

</Sandpack>

ржЙржкрж░рзЗрж░ sandbox ржП, input рж╢рзБржзрзБржорж╛рждрзНрж░ `message` state variable ржЖржкржбрзЗржЯ ржХрж░рзЗред ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржжрзГрж╖рзНржЯрж┐ржХрзЛржг ржерзЗржХрзЗ, ржПржЯрж┐ chat connection ржХрзЗ ржкрзНрж░ржнрж╛ржмрж┐ржд ржХрж░рж╛ ржЙржЪрж┐ржд ржиржпрж╝ред рждржмрзЗ, ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖржкржирж┐ `message` ржЖржкржбрзЗржЯ ржХрж░рзЗржи, ржЖржкржирж╛рж░ component re-render рж╣ржпрж╝ред ржпржЦржи ржЖржкржирж╛рж░ component re-render рж╣ржпрж╝, ржПрж░ ржнрж┐рждрж░рзЗрж░ ржХрзЛржб ржЖржмрж╛рж░ рж╢рзБрж░рзБ ржерзЗржХрзЗ ржЪрж╛рж▓рзБ рж╣ржпрж╝ред

ржкрзНрж░рждрж┐ржЯрж┐ `ChatRoom` component ржПрж░ re-render ржП ржПржХржЯрж┐ ржирждрзБржи `options` object рж╢рзБрж░рзБ ржерзЗржХрзЗ рждрзИрж░рж┐ рж╣ржпрж╝ред React ржжрзЗржЦрзЗ ржпрзЗ `options` object рж╢рзЗрж╖ render ржПрж░ рж╕ржоржпрж╝ рждрзИрж░рж┐ `options` object ржерзЗржХрзЗ ржПржХржЯрж┐ *ржнрж┐ржирзНржи object*ред ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рзЗ (ржпрж╛ `options` ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ), ржПржмржВ ржЖржкржирж┐ ржЯрж╛ржЗржк ржХрж░рж╛рж░ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ред

**ржПржЗ рж╕ржорж╕рзНржпрж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ object ржПржмржВ function ржХрзЗ ржкрзНрж░ржнрж╛ржмрж┐ржд ржХрж░рзЗред JavaScript ржП, ржкрзНрж░рждрж┐ржЯрж┐ ржирждрзБржи рждрзИрж░рж┐ object ржПржмржВ function ржЕржирзНржп рж╕ржмржЧрзБрж▓рж┐ ржерзЗржХрзЗ ржЖрж▓рж╛ржжрж╛ ржмрж▓рзЗ ржмрж┐ржмрзЗржЪрж┐ржд рж╣ржпрж╝ред ржПржЯрж┐ ржХрзЛржи ржмрзНржпрж╛ржкрж╛рж░ ржирж╛ ржпрзЗ рждрж╛ржжрзЗрж░ ржнрж┐рждрж░рзЗрж░ content ржПржХржЗ рж╣рждрзЗ ржкрж╛рж░рзЗ!**

```js {7-8}
// During the first render
const options1 = { serverUrl: 'https://localhost:1234', roomId: 'music' };

// During the next render
const options2 = { serverUrl: 'https://localhost:1234', roomId: 'music' };

// These are two different objects!
console.log(Object.is(options1, options2)); // false
```

**Object ржПржмржВ function dependency ржЖржкржирж╛рж░ Effect ржХрзЗ ржЖржкржирж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржирзЗрж░ ржЪрзЗржпрж╝рзЗ ржмрзЗрж╢рж┐ ржШржи ржШржи ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗред**

ржПржЗ ржХрж╛рж░ржгрзЗржЗ, ржпржЦржиржЗ рж╕ржорзНржнржм, ржЖржкржирж╛рж░ Effect ржПрж░ dependency рж╣рж┐рж╕рж╛ржмрзЗ object ржПржмржВ function ржПржбрж╝рж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржкрж░рж┐ржмрж░рзНрждрзЗ, рждрж╛ржжрзЗрж░ component ржПрж░ ржмрж╛ржЗрж░рзЗ, Effect ржПрж░ ржнрж┐рждрж░рзЗ рж╕рж░рж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи, ржЕржержмрж╛ рждрж╛ржжрзЗрж░ ржерзЗржХрзЗ primitive value extract ржХрж░рзБржиред


#### Static object ржПржмржВ function ржЖржкржирж╛рж░ component ржПрж░ ржмрж╛ржЗрж░рзЗ рж╕рж░рж╛ржи {/*move-static-objects-and-functions-outside-your-component*/}

ржпржжрж┐ object ржХрзЛржирзЛ props ржПржмржВ state ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржирж╛ ржХрж░рзЗ, ржЖржкржирж┐ рж╕рзЗржЗ object ржЖржкржирж╛рж░ component ржПрж░ ржмрж╛ржЗрж░рзЗ рж╕рж░рж╛рждрзЗ ржкрж╛рж░рзЗржи:

```js {1-4,13}
const options = {
  serverUrl: 'https://localhost:1234',
  roomId: 'music'
};

function ChatRoom() {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, []); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржЗржнрж╛ржмрзЗ, ржЖржкржирж┐ linter ржХрзЗ *ржкрзНрж░ржорж╛ржг* ржХрж░рзЗржи ржпрзЗ ржПржЯрж┐ reactive ржиржпрж╝ред ржПржЯрж┐ ржПржХржЯрж┐ re-render ржПрж░ ржлрж▓рзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ ржирж╛, рждрж╛ржЗ ржПржЯрж┐ ржПржХржЯрж┐ dependency рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред ржПржЦржи `ChatRoom` re-render ржХрж░рж▓рзЗ ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ рж╣ржмрзЗ ржирж╛ред

ржПржЯрж┐ function ржПрж░ ржЬржирзНржпржУ ржХрж╛ржЬ ржХрж░рзЗ:

```js {1-6,12}
function createOptions() {
  return {
    serverUrl: 'https://localhost:1234',
    roomId: 'music'
  };
}

function ChatRoom() {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const options = createOptions();
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, []); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржпрзЗрж╣рзЗрждрзБ `createOptions` ржЖржкржирж╛рж░ component ржПрж░ ржмрж╛ржЗрж░рзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржПржЯрж┐ ржПржХржЯрж┐ reactive value ржиржпрж╝ред ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржПрж░ dependency рждрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ, ржПржмржВ ржХрзЗржи ржПржЯрж┐ ржХржЦржиржУ ржЖржкржирж╛рж░ Effect ржХрзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░ржмрзЗ ржирж╛ред

#### Dynamic object ржПржмржВ function ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ рж╕рж░рж╛ржи {/*move-dynamic-objects-and-functions-inside-your-effect*/}

ржпржжрж┐ ржЖржкржирж╛рж░ object ржХрзЛржирзЛ reactive value ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржпрж╛ ржПржХржЯрж┐ re-render ржПрж░ ржлрж▓рзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ, ржпрзЗржоржи ржПржХржЯрж┐ `roomId` prop, ржЖржкржирж┐ ржПржЯрж┐ ржЖржкржирж╛рж░ component ржПрж░ *ржмрж╛ржЗрж░рзЗ* ржЯрж╛ржирждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ред рждржмрзЗ, ржЖржкржирж┐ ржПрж░ creation ржЖржкржирж╛рж░ Effect ржПрж░ ржХрзЛржбрзЗрж░ *ржнрж┐рждрж░рзЗ* рж╕рж░рж╛рждрзЗ ржкрж╛рж░рзЗржи:

```js {7-10,11,14}
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржЦржи ржпрзЗрж╣рзЗрждрзБ `options` ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржПржЯрж┐ ржЖрж░ ржЖржкржирж╛рж░ Effect ржПрж░ ржПржХржЯрж┐ dependency ржиржпрж╝ред ржкрж░рж┐ржмрж░рзНрждрзЗ, ржЖржкржирж╛рж░ Effect ржжрзНржмрж╛рж░рж╛ ржмрзНржпржмрж╣рзГржд ржПржХржорж╛рждрзНрж░ reactive value рж╣рж▓ `roomId`ред ржпрзЗрж╣рзЗрждрзБ `roomId` ржПржХржЯрж┐ object ржмрж╛ function ржиржпрж╝, ржЖржкржирж┐ ржирж┐рж╢рзНржЪрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗржи ржпрзЗ ржПржЯрж┐ *ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ* ржнрж┐ржирзНржи рж╣ржмрзЗ ржирж╛ред JavaScript ржП, number ржПржмржВ string рждрж╛ржжрзЗрж░ content ржжрзНржмрж╛рж░рж╛ рждрзБрж▓ржирж╛ ржХрж░рж╛ рж╣ржпрж╝:

```js {7-8}
// During the first render
const roomId1 = 'music';

// During the next render
const roomId2 = 'music';

// These two strings are the same!
console.log(Object.is(roomId1, roomId2)); // true
```

ржПржЗ fix ржПрж░ ржЬржирзНржп ржзржирзНржпржмрж╛ржж, ржпржжрж┐ ржЖржкржирж┐ input edit ржХрж░рзЗржи рждрж╛рж╣рж▓рзЗ chat ржЖрж░ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ ржирж╛:

<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return (
    <>
      <h1>Welcome to the {roomId} room!</h1>
      <input value={message} onChange={e => setMessage(e.target.value)} />
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}
```

```js src/chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input { display: block; margin-bottom: 20px; }
button { margin-left: 10px; }
```

</Sandpack>

рждржмрзЗ, ржПржЯрж┐ *ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝* ржпржЦржи ржЖржкржирж┐ `roomId` dropdown ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗржи, ржпрзЗржоржиржЯрж┐ ржЖржкржирж┐ ржЖрж╢рж╛ ржХрж░ржмрзЗржиред

ржПржЯрж┐ function ржПрж░ ржЬржирзНржпржУ ржХрж╛ржЬ ржХрж░рзЗ:

```js {7-12,14}
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    function createOptions() {
      return {
        serverUrl: serverUrl,
        roomId: roomId
      };
    }

    const options = createOptions();
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ logic ржПрж░ ржЕржВрж╢ржЧрзБрж▓рж┐ group ржХрж░рждрзЗ ржЖржкржирж╛рж░ ржирж┐ржЬрж╕рзНржм function рж▓рж┐ржЦрждрзЗ ржкрж╛рж░рзЗржиред ржпрждржХрзНрж╖ржг ржЖржкржирж┐ рждрж╛ржжрзЗрж░ ржЖржкржирж╛рж░ Effect ржПрж░ *ржнрж┐рждрж░рзЗ* ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рзЗржи, рждрж╛рж░рж╛ reactive value ржиржпрж╝, ржПржмржВ рждрж╛ржЗ рждрж╛ржжрзЗрж░ ржЖржкржирж╛рж░ Effect ржПрж░ dependency рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред


#### Object ржерзЗржХрзЗ primitive value ржкржбрж╝рзБржи {/*read-primitive-values-from-objects*/}

ржХржЦржиржУ ржХржЦржиржУ, ржЖржкржирж┐ props ржерзЗржХрзЗ ржПржХржЯрж┐ object ржкрзЗрждрзЗ ржкрж╛рж░рзЗржи:

```js {1,5,8}
function ChatRoom({ options }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржЦрж╛ржирзЗ ржЭрзБржБржХрж┐ рж╣рж▓ parent component rendering ржПрж░ рж╕ржоржпрж╝ object рждрзИрж░рж┐ ржХрж░ржмрзЗ:

```js {3-6}
<ChatRoom
  roomId={roomId}
  options={{
    serverUrl: serverUrl,
    roomId: roomId
  }}
/>
```

ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржХрзЗ ржкрзНрж░рждрж┐ржмрж╛рж░ parent component re-render рж╣рж▓рзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд ржХрж░ржмрзЗред ржПржЯрж┐ ржарж┐ржХ ржХрж░рждрзЗ, Effect ржПрж░ *ржмрж╛ржЗрж░рзЗ* object ржерзЗржХрзЗ information ржкржбрж╝рзБржи, ржПржмржВ object ржПржмржВ function dependency ржерж╛ржХрж╛ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи:

```js {4,7-8,12}
function ChatRoom({ options }) {
  const [message, setMessage] = useState('');

  const { roomId, serverUrl } = options;
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

Logic ржЯрж┐ ржПржХржЯрзБ repetitive рж╣ржпрж╝ (ржЖржкржирж┐ ржПржХржЯрж┐ Effect ржПрж░ ржмрж╛ржЗрж░рзЗ ржПржХржЯрж┐ object ржерзЗржХрзЗ ржХрж┐ржЫрзБ value ржкржбрж╝рзЗржи, ржПржмржВ рждрж╛рж░ржкрж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ ржПржХржЗ value ржжрж┐ржпрж╝рзЗ ржПржХржЯрж┐ object рждрзИрж░рж┐ ржХрж░рзЗржи)ред ржХрж┐ржирзНрждрзБ ржПржЯрж┐ ржЦрзБржм рж╕рзНржкрж╖рзНржЯ ржХрж░рзЗ ржпрзЗ ржЖржкржирж╛рж░ Effect *ржЖрж╕рж▓рзЗ* ржХрзЛржи information ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗред ржпржжрж┐ parent component ржжрзНржмрж╛рж░рж╛ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ ржПржХржЯрж┐ object ржкрзБржирж░рж╛ржпрж╝ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝, chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗ ржирж╛ред рждржмрзЗ, ржпржжрж┐ `options.roomId` ржмрж╛ `options.serverUrl` рж╕рждрзНржпрж┐ржЗ ржнрж┐ржирзНржи рж╣ржпрж╝, chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржмрзЗред

#### Function ржерзЗржХрзЗ primitive value ржЧржгржирж╛ ржХрж░рзБржи {/*calculate-primitive-values-from-functions*/}

ржПржХржЗ ржкржжрзНржзрждрж┐ function ржПрж░ ржЬржирзНржп ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржзрж░рзБржи parent component ржПржХржЯрж┐ function ржкрж╛рж╕ ржХрж░рзЗ:

```js {3-8}
<ChatRoom
  roomId={roomId}
  getOptions={() => {
    return {
      serverUrl: serverUrl,
      roomId: roomId
    };
  }}
/>
```

ржПржЯрж┐ ржПржХржЯрж┐ dependency ржХрж░рж╛ ржПржбрж╝рж╛рждрзЗ (ржПржмржВ re-render ржП ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржУржпрж╝рж╛ ржПржбрж╝рж╛рждрзЗ), Effect ржПрж░ ржмрж╛ржЗрж░рзЗ ржПржЯрж┐ call ржХрж░рзБржиред ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ `roomId` ржПржмржВ `serverUrl` value ржжрзЗржпрж╝ ржпрж╛ object ржиржпрж╝, ржПржмржВ ржпрж╛ ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░ ржерзЗржХрзЗ ржкржбрж╝рждрзЗ ржкрж╛рж░рзЗржи:

```js {1,4}
function ChatRoom({ getOptions }) {
  const [message, setMessage] = useState('');

  const { roomId, serverUrl } = getOptions();
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
  // ...
```

ржПржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ [pure](/learn/keeping-components-pure) function ржПрж░ ржЬржирзНржп ржХрж╛ржЬ ржХрж░рзЗ ржХрж╛рж░ржг rendering ржПрж░ рж╕ржоржпрж╝ рждрж╛ржжрзЗрж░ call ржХрж░рж╛ ржирж┐рж░рж╛ржкржжред ржпржжрж┐ ржЖржкржирж╛рж░ function ржПржХржЯрж┐ event handler рж╣ржпрж╝, ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ ржЪрж╛ржи ржирж╛ ржПрж░ ржкрж░рж┐ржмрж░рзНрждржи ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛ржЗржЬ ржХрж░рзБржХ, [ржкрж░рж┐ржмрж░рзНрждрзЗ ржПржЯрж┐ ржПржХржЯрж┐ Effect Event ржП wrap ржХрж░рзБржиред](#do-you-want-to-read-a-value-without-reacting-to-its-changes)

<Recap>

- Dependency рж╕рж░рзНржмржжрж╛ ржХрзЛржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рждрзЗ рж╣ржмрзЗред
- ржпржЦржи ржЖржкржирж┐ ржЖржкржирж╛рж░ dependency ржирж┐ржпрж╝рзЗ рж╕ржирзНрждрзБрж╖рзНржЯ ржиржи, ржЖржкржирж╛ржХрзЗ ржпрж╛ edit ржХрж░рждрзЗ рж╣ржмрзЗ рждрж╛ рж╣рж▓ ржХрзЛржбред
- Linter suppress ржХрж░рж╛ ржЦрзБржм ржмрж┐ржнрзНрж░рж╛ржирзНрждрж┐ржХрж░ bug ржПрж░ ржжрж┐ржХрзЗ ржирж┐ржпрж╝рзЗ ржпрж╛ржпрж╝, ржПржмржВ ржЖржкржирж╛рж░ рж╕рж░рзНржмржжрж╛ ржПржЯрж┐ ржПржбрж╝рж╛ржирзЛ ржЙржЪрж┐рждред
- ржПржХржЯрж┐ dependency рж╕рж░рж╛рждрзЗ, ржЖржкржирж╛ржХрзЗ linter ржХрзЗ "ржкрзНрж░ржорж╛ржг" ржХрж░рждрзЗ рж╣ржмрзЗ ржпрзЗ ржПржЯрж┐ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржиржпрж╝ред
- ржпржжрж┐ ржХрж┐ржЫрзБ ржХрзЛржб ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ interaction ржПрж░ ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд, рж╕рзЗржЗ ржХрзЛржб ржПржХржЯрж┐ event handler ржП рж╕рж░рж╛ржиред
- ржпржжрж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржмрж┐ржнрж┐ржирзНржи ржЕржВрж╢ ржмрж┐ржнрж┐ржирзНржи ржХрж╛рж░ржгрзЗ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд, ржПржЯрж┐ ржмрж┐ржнрж┐ржирзНржи Effect ржП ржмрж┐ржнржХрзНржд ржХрж░рзБржиред
- ржпржжрж┐ ржЖржкржирж┐ ржкрзВрж░рзНржмржмрж░рзНрждрзА state ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ ржХрж┐ржЫрзБ state ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЪрж╛ржи, ржПржХржЯрж┐ updater function ржкрж╛рж╕ ржХрж░рзБржиред
- ржпржжрж┐ ржЖржкржирж┐ "react" ржирж╛ ржХрж░рзЗ рж╕рж░рзНржмрж╢рзЗрж╖ ржорж╛ржи ржкржбрж╝рждрзЗ ржЪрж╛ржи, ржЖржкржирж╛рж░ Effect ржерзЗржХрзЗ ржПржХржЯрж┐ Effect Event extract ржХрж░рзБржиред
- JavaScript ржП, object ржПржмржВ function ржнрж┐ржирзНржи ржмрж▓рзЗ ржмрж┐ржмрзЗржЪрж┐ржд рж╣ржпрж╝ ржпржжрж┐ рждрж╛рж░рж╛ ржмрж┐ржнрж┐ржирзНржи рж╕ржоржпрж╝рзЗ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝ред
- Object ржПржмржВ function dependency ржПржбрж╝рж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред рждрж╛ржжрзЗрж░ component ржПрж░ ржмрж╛ржЗрж░рзЗ ржмрж╛ Effect ржПрж░ ржнрж┐рждрж░рзЗ рж╕рж░рж╛ржиред

</Recap>

<Challenges>

#### ржПржХржЯрж┐ resetting interval ржарж┐ржХ ржХрж░рзБржи {/*fix-a-resetting-interval*/}

ржПржЗ Effect ржПржХржЯрж┐ interval setup ржХрж░рзЗ ржпрж╛ ржкрзНрж░рждрж┐ рж╕рзЗржХрзЗржирзНржбрзЗ tick ржХрж░рзЗред ржЖржкржирж┐ ржХрж┐ржЫрзБ ржЕржжрзНржнрзБржд ржШржЯрждрзЗ ржжрзЗржЦрзЗржЫрзЗржи: ржоржирзЗ рж╣ржЪрзНржЫрзЗ interval ржкрзНрж░рждрж┐ржмрж╛рж░ tick ржХрж░рж╛рж░ рж╕ржоржпрж╝ destroy ржПржмржВ re-create рж╣ржпрж╝ред ржХрзЛржб ржарж┐ржХ ржХрж░рзБржи ржпрж╛рждрзЗ interval ржХрзНрж░ржорж╛ржЧржд ржкрзБржирж░рж╛ржпрж╝ рждрзИрж░рж┐ ржирж╛ рж╣ржпрж╝ред

<Hint>

ржоржирзЗ рж╣ржЪрзНржЫрзЗ ржПржЗ Effect ржПрж░ ржХрзЛржб `count` ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗред ржПржЗ dependency ржПрж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирж╛ рж╣ржУржпрж╝рж╛рж░ ржХрзЛржирзЛ ржЙржкрж╛ржпрж╝ ржЖржЫрзЗ ржХрж┐? рж╕рзЗржЗ value ржП dependency ржпрзЛржЧ ржирж╛ ржХрж░рзЗ рждрж╛рж░ ржкрзВрж░рзНржмржмрж░рзНрждрзА ржорж╛ржирзЗрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ `count` state ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржПржХржЯрж┐ ржЙржкрж╛ржпрж╝ ржерж╛ржХрж╛ ржЙржЪрж┐рждред

</Hint>

<Sandpack>

```js
import { useState, useEffect } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log('тЬЕ Creating an interval');
    const id = setInterval(() => {
      console.log('тП░ Interval tick');
      setCount(count + 1);
    }, 1000);
    return () => {
      console.log('тЭМ Clearing an interval');
      clearInterval(id);
    };
  }, [count]);

  return <h1>Counter: {count}</h1>
}
```

</Sandpack>

<Solution>

ржЖржкржирж┐ Effect ржПрж░ ржнрж┐рждрж░ ржерзЗржХрзЗ `count` state ржХрзЗ `count + 1` ржП ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЪрж╛ржиред рждржмрзЗ, ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржХрзЗ `count` ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░рж╢рзАрж▓ ржХрж░рзЗ, ржпрж╛ ржкрзНрж░рждрж┐ржЯрж┐ tick ржП ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝, ржПржмржВ ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржЖржкржирж╛рж░ interval ржкрзНрж░рждрж┐ржЯрж┐ tick ржП ржкрзБржирж░рж╛ржпрж╝ рждрзИрж░рж┐ рж╣ржпрж╝ред

ржПржЯрж┐ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, [updater function](/reference/react/useState#updating-state-based-on-the-previous-state) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржПржмржВ `setCount(count + 1)` ржПрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ `setCount(c => c + 1)` рж▓рж┐ржЦрзБржи:

<Sandpack>

```js
import { useState, useEffect } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log('тЬЕ Creating an interval');
    const id = setInterval(() => {
      console.log('тП░ Interval tick');
      setCount(c => c + 1);
    }, 1000);
    return () => {
      console.log('тЭМ Clearing an interval');
      clearInterval(id);
    };
  }, []);

  return <h1>Counter: {count}</h1>
}
```

</Sandpack>

Effect ржПрж░ ржнрж┐рждрж░рзЗ `count` ржкржбрж╝рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ, ржЖржкржирж┐ React ржХрзЗ `c => c + 1` instruction ("ржПржЗ number ржмрзГржжрзНржзрж┐ ржХрж░рзБржи!") ржкрж╛рж╕ ржХрж░рзЗржиред React ржПржЯрж┐ ржкрж░ржмрж░рзНрждрзА render ржП ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░ржмрзЗред ржПржмржВ ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛ржХрзЗ ржЖрж░ ржЖржкржирж╛рж░ Effect ржПрж░ ржнрж┐рждрж░рзЗ `count` ржПрж░ ржорж╛ржи ржкржбрж╝рждрзЗ рж╣ржмрзЗ ржирж╛, ржЖржкржирж┐ ржЖржкржирж╛рж░ Effect ржПрж░ dependency ржЦрж╛рж▓рж┐ (`[]`) рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗржиред ржПржЗ fix interval ржХрзЗ ржкрзНрж░рждрж┐ржЯрж┐ tick ржП ржкрзБржирж░рж╛ржпрж╝ рждрзИрж░рж┐ рж╣ржУржпрж╝рж╛ ржерзЗржХрзЗ ржмрж╛ржзрж╛ ржжрзЗржпрж╝ред

</Solution>


#### ржПржХржЯрж┐ retriggering animation ржарж┐ржХ ржХрж░рзБржи {/*fix-a-retriggering-animation*/}

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржпржЦржи ржЖржкржирж┐ "Show" ржЪрж╛ржкрзЗржи, ржПржХржЯрж┐ welcome message fade in рж╣ржпрж╝ред animation ржПржХ рж╕рзЗржХрзЗржирзНржб рж╕ржоржпрж╝ ржирзЗржпрж╝ред ржпржЦржи ржЖржкржирж┐ "Remove" ржЪрж╛ржкрзЗржи, welcome message ржЕржмрж┐рж▓ржорзНржмрзЗ ржЕржжрзГрж╢рзНржп рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ред fade-in animation ржПрж░ logic `animation.js` file ржП plain JavaScript [animation loop](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame) рж╣рж┐рж╕рж╛ржмрзЗ implement ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржкржирж╛ржХрзЗ рж╕рзЗржЗ logic ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛ред ржЖржкржирж┐ ржПржЯрж┐ржХрзЗ ржПржХржЯрж┐ third-party library рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржЖржкржирж╛рж░ Effect DOM node ржПрж░ ржЬржирзНржп `FadeInAnimation` ржПрж░ ржПржХржЯрж┐ instance рждрзИрж░рж┐ ржХрж░рзЗ, ржПржмржВ рждрж╛рж░ржкрж░ animation ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржХрж░рждрзЗ `start(duration)` ржмрж╛ `stop()` call ржХрж░рзЗред `duration` ржПржХржЯрж┐ slider ржжрзНржмрж╛рж░рж╛ ржирж┐ржпрж╝ржирзНрждрзНрж░рж┐ржд рж╣ржпрж╝ред slider рж╕рж╛ржоржЮрзНржЬрж╕рзНржп ржХрж░рзБржи ржПржмржВ ржжрзЗржЦрзБржи animation ржХрж┐ржнрж╛ржмрзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝ред

ржПржЗ ржХрзЛржб ржЗрждрж┐ржоржзрзНржпрзЗ ржХрж╛ржЬ ржХрж░рзЗ, ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ ржХрж┐ржЫрзБ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржЪрж╛ржиред ржмрж░рзНрждржорж╛ржирзЗ, ржпржЦржи ржЖржкржирж┐ slider рж╕рж░рж╛ржи ржпрж╛ `duration` state variable ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржХрж░рзЗ, ржПржЯрж┐ animation ржкрзБржирж░рж╛ржпрж╝ trigger ржХрж░рзЗред ржЖржЪрж░ржг ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи ржпрж╛рждрзЗ Effect `duration` variable ржПрж░ ржкрзНрж░рждрж┐ "react" ржирж╛ ржХрж░рзЗред ржпржЦржи ржЖржкржирж┐ "Show" ржЪрж╛ржкрзЗржи, Effect slider ржП ржмрж░рзНрждржорж╛ржи `duration` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЙржЪрж┐рждред рждржмрзЗ, slider рж╕рж░рж╛ржирзЛ ржирж┐ржЬрзЗ ржерзЗржХрзЗ animation ржкрзБржирж░рж╛ржпрж╝ trigger ржХрж░рж╛ ржЙржЪрж┐ржд ржиржпрж╝ред

<Hint>

Effect ржПрж░ ржнрж┐рждрж░рзЗ ржХрж┐ ржХрзЛржбрзЗрж░ ржПржХржЯрж┐ рж▓рж╛ржЗржи ржЖржЫрзЗ ржпрж╛ reactive рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржиржпрж╝? ржЖржкржирж┐ ржХрж┐ржнрж╛ржмрзЗ non-reactive ржХрзЛржб Effect ржерзЗржХрзЗ ржмрзЗрж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи?

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect, useRef } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { FadeInAnimation } from './animation.js';

function Welcome({ duration }) {
  const ref = useRef(null);

  useEffect(() => {
    const animation = new FadeInAnimation(ref.current);
    animation.start(duration);
    return () => {
      animation.stop();
    };
  }, [duration]);

  return (
    <h1
      ref={ref}
      style={{
        opacity: 0,
        color: 'white',
        padding: 50,
        textAlign: 'center',
        fontSize: 50,
        backgroundImage: 'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'
      }}
    >
      Welcome
    </h1>
  );
}

export default function App() {
  const [duration, setDuration] = useState(1000);
  const [show, setShow] = useState(false);

  return (
    <>
      <label>
        <input
          type="range"
          min="100"
          max="3000"
          value={duration}
          onChange={e => setDuration(Number(e.target.value))}
        />
        <br />
        Fade in duration: {duration} ms
      </label>
      <button onClick={() => setShow(!show)}>
        {show ? 'Remove' : 'Show'}
      </button>
      <hr />
      {show && <Welcome duration={duration} />}
    </>
  );
}
```

```js src/animation.js
export class FadeInAnimation {
  constructor(node) {
    this.node = node;
  }
  start(duration) {
    this.duration = duration;
    if (this.duration === 0) {
      // Jump to end immediately
      this.onProgress(1);
    } else {
      this.onProgress(0);
      // Start animating
      this.startTime = performance.now();
      this.frameId = requestAnimationFrame(() => this.onFrame());
    }
  }
  onFrame() {
    const timePassed = performance.now() - this.startTime;
    const progress = Math.min(timePassed / this.duration, 1);
    this.onProgress(progress);
    if (progress < 1) {
      // We still have more frames to paint
      this.frameId = requestAnimationFrame(() => this.onFrame());
    }
  }
  onProgress(progress) {
    this.node.style.opacity = progress;
  }
  stop() {
    cancelAnimationFrame(this.frameId);
    this.startTime = null;
    this.frameId = null;
    this.duration = 0;
  }
}
```

```css
label, button { display: block; margin-bottom: 20px; }
html, body { min-height: 300px; }
```

</Sandpack>

<Solution>

ржЖржкржирж╛рж░ Effect ржХрзЗ `duration` ржПрж░ рж╕рж░рзНржмрж╢рзЗрж╖ ржорж╛ржи ржкржбрж╝рждрзЗ рж╣ржмрзЗ, ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ ржЪрж╛ржи ржирж╛ ржПржЯрж┐ `duration` ржПрж░ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрзНрж░рждрж┐ "react" ржХрж░рзБржХред ржЖржкржирж┐ animation рж╢рзБрж░рзБ ржХрж░рждрзЗ `duration` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи, ржХрж┐ржирзНрждрзБ animation рж╢рзБрж░рзБ ржХрж░рж╛ reactive ржиржпрж╝ред non-reactive ржХрзЛржбрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржПржХржЯрж┐ Effect Event ржП extract ржХрж░рзБржи, ржПржмржВ ржЖржкржирж╛рж░ Effect ржерзЗржХрзЗ рж╕рзЗржЗ function call ржХрж░рзБржиред

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect, useRef } from 'react';
import { FadeInAnimation } from './animation.js';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

function Welcome({ duration }) {
  const ref = useRef(null);

  const onAppear = useEffectEvent(animation => {
    animation.start(duration);
  });

  useEffect(() => {
    const animation = new FadeInAnimation(ref.current);
    onAppear(animation);
    return () => {
      animation.stop();
    };
  }, []);

  return (
    <h1
      ref={ref}
      style={{
        opacity: 0,
        color: 'white',
        padding: 50,
        textAlign: 'center',
        fontSize: 50,
        backgroundImage: 'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'
      }}
    >
      Welcome
    </h1>
  );
}

export default function App() {
  const [duration, setDuration] = useState(1000);
  const [show, setShow] = useState(false);

  return (
    <>
      <label>
        <input
          type="range"
          min="100"
          max="3000"
          value={duration}
          onChange={e => setDuration(Number(e.target.value))}
        />
        <br />
        Fade in duration: {duration} ms
      </label>
      <button onClick={() => setShow(!show)}>
        {show ? 'Remove' : 'Show'}
      </button>
      <hr />
      {show && <Welcome duration={duration} />}
    </>
  );
}
```

```js src/animation.js
export class FadeInAnimation {
  constructor(node) {
    this.node = node;
  }
  start(duration) {
    this.duration = duration;
    this.onProgress(0);
    this.startTime = performance.now();
    this.frameId = requestAnimationFrame(() => this.onFrame());
  }
  onFrame() {
    const timePassed = performance.now() - this.startTime;
    const progress = Math.min(timePassed / this.duration, 1);
    this.onProgress(progress);
    if (progress < 1) {
      // We still have more frames to paint
      this.frameId = requestAnimationFrame(() => this.onFrame());
    }
  }
  onProgress(progress) {
    this.node.style.opacity = progress;
  }
  stop() {
    cancelAnimationFrame(this.frameId);
    this.startTime = null;
    this.frameId = null;
    this.duration = 0;
  }
}
```

```css
label, button { display: block; margin-bottom: 20px; }
html, body { min-height: 300px; }
```

</Sandpack>

`onAppear` ржПрж░ ржорждрзЛ Effect Event reactive ржиржпрж╝, рждрж╛ржЗ ржЖржкржирж┐ animation ржкрзБржирж░рж╛ржпрж╝ trigger ржирж╛ ржХрж░рзЗ ржПрж░ ржнрж┐рждрж░рзЗ `duration` ржкржбрж╝рждрзЗ ржкрж╛рж░рзЗржиред

</Solution>


#### ржПржХржЯрж┐ reconnecting chat ржарж┐ржХ ржХрж░рзБржи {/*fix-a-reconnecting-chat*/}

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖржкржирж┐ "Toggle theme" ржЪрж╛ржкрж▓рзЗ, chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ред ржПржЯрж┐ ржХрзЗржи ржШржЯрзЗ? ржнрзБрж▓ ржарж┐ржХ ржХрж░рзБржи ржпрж╛рждрзЗ chat рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ ржпржЦржи ржЖржкржирж┐ Server URL edit ржХрж░рзЗржи ржмрж╛ ржПржХржЯрж┐ ржнрж┐ржирзНржи chat room ржмрзЗржЫрзЗ ржирзЗржиред

`chat.js` ржХрзЗ ржПржХржЯрж┐ external third-party library рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рзБржи: ржЖржкржирж┐ ржПрж░ API ржЪрзЗржХ ржХрж░рждрзЗ ржПржЯрж┐ consult ржХрж░рждрзЗ ржкрж╛рж░рзЗржи, ржХрж┐ржирзНрждрзБ ржПржЯрж┐ edit ржХрж░ржмрзЗржи ржирж╛ред

<Hint>

ржПржЯрж┐ ржарж┐ржХ ржХрж░рж╛рж░ ржПржХрж╛ржзрж┐ржХ ржЙржкрж╛ржпрж╝ ржЖржЫрзЗ, ржХрж┐ржирзНрждрзБ рж╢рзЗрж╖ ржкрж░рзНржпржирзНржд ржЖржкржирж┐ ржПржХржЯрж┐ object ржХрзЗ ржЖржкржирж╛рж░ dependency рж╣рж┐рж╕рж╛ржмрзЗ рж░рж╛ржЦрж╛ ржПржбрж╝рж╛рждрзЗ ржЪрж╛ржиред

</Hint>

<Sandpack>

```js src/App.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';

export default function App() {
  const [isDark, setIsDark] = useState(false);
  const [roomId, setRoomId] = useState('general');
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

  return (
    <div className={isDark ? 'dark' : 'light'}>
      <button onClick={() => setIsDark(!isDark)}>
        Toggle theme
      </button>
      <label>
        Server URL:{' '}
        <input
          value={serverUrl}
          onChange={e => setServerUrl(e.target.value)}
        />
      </label>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom options={options} />
    </div>
  );
}
```

```js src/ChatRoom.js active
import { useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom({ options }) {
  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]);

  return <h1>Welcome to the {options.roomId} room!</h1>;
}
```

```js src/chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
label, button { display: block; margin-bottom: 5px; }
.dark { background: #222; color: #eee; }
```

</Sandpack>

<Solution>

ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ рж╣ржЪрзНржЫрзЗ ржХрж╛рж░ржг ржПржЯрж┐ `options` object ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗред Object ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ ржкрзБржирж░рж╛ржпрж╝ рждрзИрж░рж┐ рж╣рждрзЗ ржкрж╛рж░рзЗ, ржЖржкржирж╛рж░ ржпржЦржиржЗ рж╕ржорзНржнржм рждрж╛ржжрзЗрж░ ржЖржкржирж╛рж░ Effect ржПрж░ dependency рж╣рж┐рж╕рж╛ржмрзЗ ржПржбрж╝рж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж╛ ржЙржЪрж┐рждред

рж╕ржмржЪрзЗржпрж╝рзЗ ржХржо invasive fix рж╣рж▓ Effect ржПрж░ ржарж┐ржХ ржмрж╛ржЗрж░рзЗ `roomId` ржПржмржВ `serverUrl` ржкржбрж╝рж╛, ржПржмржВ рждрж╛рж░ржкрж░ Effect ржХрзЗ рж╕рзЗржЗ primitive value ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░рж╢рзАрж▓ ржХрж░рж╛ (ржпрж╛ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ ржирж╛)ред Effect ржПрж░ ржнрж┐рждрж░рзЗ, ржПржХржЯрж┐ object рждрзИрж░рж┐ ржХрж░рзБржи ржПржмржВ ржПржЯрж┐ `createConnection` ржП ржкрж╛рж╕ ржХрж░рзБржи:

<Sandpack>

```js src/App.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';

export default function App() {
  const [isDark, setIsDark] = useState(false);
  const [roomId, setRoomId] = useState('general');
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  const options = {
    serverUrl: serverUrl,
    roomId: roomId
  };

  return (
    <div className={isDark ? 'dark' : 'light'}>
      <button onClick={() => setIsDark(!isDark)}>
        Toggle theme
      </button>
      <label>
        Server URL:{' '}
        <input
          value={serverUrl}
          onChange={e => setServerUrl(e.target.value)}
        />
      </label>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom options={options} />
    </div>
  );
}
```

```js src/ChatRoom.js active
import { useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom({ options }) {
  const { roomId, serverUrl } = options;
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]);

  return <h1>Welcome to the {options.roomId} room!</h1>;
}
```

```js src/chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
label, button { display: block; margin-bottom: 5px; }
.dark { background: #222; color: #eee; }
```

</Sandpack>

object `options` prop ржХрзЗ ржЖрж░ржУ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ `roomId` ржПржмржВ `serverUrl` props ржжрж┐ржпрж╝рзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рж╛ ржЖрж░ржУ ржнрж╛рж▓рзЛ рж╣ржмрзЗ:

<Sandpack>

```js src/App.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';

export default function App() {
  const [isDark, setIsDark] = useState(false);
  const [roomId, setRoomId] = useState('general');
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  return (
    <div className={isDark ? 'dark' : 'light'}>
      <button onClick={() => setIsDark(!isDark)}>
        Toggle theme
      </button>
      <label>
        Server URL:{' '}
        <input
          value={serverUrl}
          onChange={e => setServerUrl(e.target.value)}
        />
      </label>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        serverUrl={serverUrl}
      />
    </div>
  );
}
```

```js src/ChatRoom.js active
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom({ roomId, serverUrl }) {
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]);

  return <h1>Welcome to the {roomId} room!</h1>;
}
```

```js src/chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('тЭМ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
label, button { display: block; margin-bottom: 5px; }
.dark { background: #222; color: #eee; }
```

</Sandpack>

ржпржЦржиржЗ рж╕ржорзНржнржм primitive props ржП рж▓рзЗржЧрзЗ ржерж╛ржХрж╛ ржкрж░рзЗ ржЖржкржирж╛рж░ component optimize ржХрж░рж╛ рж╕рж╣ржЬ ржХрж░рзЗред

</Solution>

#### ржЖржмрж╛рж░ ржПржХржЯрж┐ reconnecting chat ржарж┐ржХ ржХрж░рзБржи {/*fix-a-reconnecting-chat-again*/}

ржПржЗ ржЙржжрж╛рж╣рж░ржг encryption рж╕рж╣ ржмрж╛ ржЫрж╛ржбрж╝рж╛ chat ржП рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ред checkbox toggle ржХрж░рзБржи ржПржмржВ console ржП ржмрж┐ржнрж┐ржирзНржи message рж▓ржХрзНрж╖рзНржп ржХрж░рзБржи ржпржЦржи encryption on ржПржмржВ off ржерж╛ржХрзЗред room ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред рждрж╛рж░ржкрж░, theme toggle ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ chat room ржП рж╕ржВржпрзБржХрзНржд ржерж╛ржХрзЗржи, ржЖржкржирж┐ ржкрзНрж░рждрж┐ ржХржпрж╝рзЗржХ рж╕рзЗржХрзЗржирзНржбрзЗ ржирждрзБржи message ржкрж╛ржмрзЗржиред ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи ржпрзЗ рждрж╛ржжрзЗрж░ рж░ржЩ ржЖржкржирж╛рж░ ржмрзЗржЫрзЗ ржирзЗржУржпрж╝рж╛ theme ржПрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рзЗред

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ, ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖржкржирж┐ theme ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж▓рзЗ chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ред ржПржЯрж┐ ржарж┐ржХ ржХрж░рзБржиред fix ржПрж░ ржкрж░рзЗ, theme ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж▓рзЗ chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд ржиржпрж╝, ржХрж┐ржирзНрждрзБ encryption setting toggle ржХрж░рж╛ ржмрж╛ room ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж▓рзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржУржпрж╝рж╛ ржЙржЪрж┐рждред

`chat.js` ржП ржХрзЛржирзЛ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░ржмрзЗржи ржирж╛ред ржПржЯрж┐ ржЫрж╛ржбрж╝рж╛, ржЖржкржирж┐ ржпрзЗржХрзЛржирзЛ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ржпрждржХрзНрж╖ржг ржПржЯрж┐ ржПржХржЗ ржЖржЪрж░ржгрзЗрж░ ржлрж▓рж╛ржлрж▓ ржжрзЗржпрж╝ред ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржЖржкржирж┐ ржХрзЛржи props ржкрж╛рж╕ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ рждрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╕рж╣рж╛ржпрж╝ржХ ржоржирзЗ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

<Hint>

ржЖржкржирж┐ ржжрзБржЯрж┐ function ржкрж╛рж╕ ржХрж░ржЫрзЗржи: `onMessage` ржПржмржВ `createConnection`ред ржЙржнржпрж╝ржЗ ржкрзНрж░рждрж┐ржмрж╛рж░ `App` re-render рж╣рж▓рзЗ рж╢рзБрж░рзБ ржерзЗржХрзЗ рждрзИрж░рж┐ рж╣ржпрж╝ред рждрж╛рж░рж╛ ржкрзНрж░рждрж┐ржмрж╛рж░ ржирждрзБржи value рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪрж┐ржд рж╣ржпрж╝, ржпрзЗ ржХрж╛рж░ржгрзЗ рждрж╛рж░рж╛ ржЖржкржирж╛рж░ Effect ржкрзБржирж░рж╛ржпрж╝ trigger ржХрж░рзЗред

ржПржЗ function ржЧрзБрж▓рж┐рж░ ржПржХржЯрж┐ ржПржХржЯрж┐ event handlerред ржЖржкржирж┐ ржХрж┐ ржПржоржи ржХрзЛржирзЛ ржЙржкрж╛ржпрж╝ ржЬрж╛ржирзЗржи ржпрзЗ ржПржХржЯрж┐ Effect ржП ржПржХржЯрж┐ event handler call ржХрж░рж╛ ржпрж╛ржпрж╝ event handler function ржПрж░ ржирждрзБржи value ржПрж░ ржкрзНрж░рждрж┐ "react" ржирж╛ ржХрж░рзЗ? ржПржЯрж┐ ржХрж╛ржЬрзЗ ржЖрж╕ржмрзЗ!

ржЕржирзНржп function ржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржЯрж┐ imported API method ржП ржХрж┐ржЫрзБ state ржкрж╛рж╕ ржХрж░рж╛рж░ ржЬржирзНржп ржмрж┐ржжрзНржпржорж╛ржиред ржПржЗ function ржХрж┐ рж╕рждрзНржпрж┐ржЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝? ржХрзЛржи essential information ржкрж╛рж╕ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ? ржЖржкржирж╛ржХрзЗ `App.js` ржерзЗржХрзЗ `ChatRoom.js` ржП ржХрж┐ржЫрзБ import рж╕рж░рж╛рждрзЗ рж╣рждрзЗ ржкрж╛рж░рзЗред

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js src/App.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';
import {
  createEncryptedConnection,
  createUnencryptedConnection,
} from './chat.js';
import { showNotification } from './notifications.js';

export default function App() {
  const [isDark, setIsDark] = useState(false);
  const [roomId, setRoomId] = useState('general');
  const [isEncrypted, setIsEncrypted] = useState(false);

  return (
    <>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <label>
        <input
          type="checkbox"
          checked={isEncrypted}
          onChange={e => setIsEncrypted(e.target.checked)}
        />
        Enable encryption
      </label>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        onMessage={msg => {
          showNotification('New message: ' + msg, isDark ? 'dark' : 'light');
        }}
        createConnection={() => {
          const options = {
            serverUrl: 'https://localhost:1234',
            roomId: roomId
          };
          if (isEncrypted) {
            return createEncryptedConnection(options);
          } else {
            return createUnencryptedConnection(options);
          }
        }}
      />
    </>
  );
}
```

```js src/ChatRoom.js active
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function ChatRoom({ roomId, createConnection, onMessage }) {
  useEffect(() => {
    const connection = createConnection();
    connection.on('message', (msg) => onMessage(msg));
    connection.connect();
    return () => connection.disconnect();
  }, [createConnection, onMessage]);

  return <h1>Welcome to the {roomId} room!</h1>;
}
```

```js src/chat.js
export function createEncryptedConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  let intervalId;
  let messageCallback;
  return {
    connect() {
      console.log('тЬЕ ЁЯФР Connecting to "' + roomId + '" room... (encrypted)');
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        if (messageCallback) {
          if (Math.random() > 0.5) {
            messageCallback('hey')
          } else {
            messageCallback('lol');
          }
        }
      }, 3000);
    },
    disconnect() {
      clearInterval(intervalId);
      messageCallback = null;
      console.log('тЭМ ЁЯФР Disconnected from "' + roomId + '" room (encrypted)');
    },
    on(event, callback) {
      if (messageCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'message') {
        throw Error('Only "message" event is supported.');
      }
      messageCallback = callback;
    },
  };
}

export function createUnencryptedConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  let intervalId;
  let messageCallback;
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room (unencrypted)...');
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        if (messageCallback) {
          if (Math.random() > 0.5) {
            messageCallback('hey')
          } else {
            messageCallback('lol');
          }
        }
      }, 3000);
    },
    disconnect() {
      clearInterval(intervalId);
      messageCallback = null;
      console.log('тЭМ Disconnected from "' + roomId + '" room (unencrypted)');
    },
    on(event, callback) {
      if (messageCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'message') {
        throw Error('Only "message" event is supported.');
      }
      messageCallback = callback;
    },
  };
}
```

```js src/notifications.js
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label, button { display: block; margin-bottom: 5px; }
```

</Sandpack>

<Solution>

ржПржЯрж┐ рж╕ржорж╛ржзрж╛ржи ржХрж░рж╛рж░ ржПржХрж╛ржзрж┐ржХ рж╕ржарж┐ржХ ржЙржкрж╛ржпрж╝ ржЖржЫрзЗ, ржХрж┐ржирзНрждрзБ ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ рж╕ржорзНржнрж╛ржмрзНржп рж╕ржорж╛ржзрж╛ржиред

ржорзВрж▓ ржЙржжрж╛рж╣рж░ржгрзЗ, theme toggle ржХрж░рж╛ ржмрж┐ржнрж┐ржирзНржи `onMessage` ржПржмржВ `createConnection` function рждрзИрж░рж┐ ржПржмржВ ржкрж╛рж╕ ржХрж░рж╛рж░ ржХрж╛рж░ржг рж╣ржпрж╝ред ржпрзЗрж╣рзЗрждрзБ Effect ржПржЗ function ржЧрзБрж▓рж┐рж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ, ржкрзНрж░рждрж┐ржмрж╛рж░ ржЖржкржирж┐ theme toggle ржХрж░рж▓рзЗ chat ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣рждред

`onMessage` ржПрж░ рж╕ржорж╕рзНржпрж╛ ржарж┐ржХ ржХрж░рждрзЗ, ржЖржкржирж╛ржХрзЗ ржПржЯрж┐ ржПржХржЯрж┐ Effect Event ржП wrap ржХрж░рждрзЗ рж╣ржпрж╝рзЗржЫрж┐рж▓:

```js {1,2,6}
export default function ChatRoom({ roomId, createConnection, onMessage }) {
  const onReceiveMessage = useEffectEvent(onMessage);

  useEffect(() => {
    const connection = createConnection();
    connection.on('message', (msg) => onReceiveMessage(msg));
    // ...
```

`onMessage` prop ржПрж░ ржмрж┐ржкрж░рзАрждрзЗ, `onReceiveMessage` Effect Event reactive ржиржпрж╝ред ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржПржЯрж┐ ржЖржкржирж╛рж░ Effect ржПрж░ ржПржХржЯрж┐ dependency рж╣ржУржпрж╝рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред ржлрж▓рж╕рзНржмрж░рзВржк, `onMessage` ржПрж░ ржкрж░рж┐ржмрж░рзНрждржи chat ржХрзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд ржХрж░ржмрзЗ ржирж╛ред

ржЖржкржирж┐ `createConnection` ржПрж░ рж╕рж╛ржерзЗ ржПржХржЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ ржХрж╛рж░ржг ржПржЯрж┐ *reactive рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд*ред ржЖржкржирж┐ *ржЪрж╛ржи* Effect ржкрзБржирж░рж╛ржпрж╝ trigger рж╣рзЛржХ ржпржжрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржХржЯрж┐ encrypted ржПржмржВ ржПржХржЯрж┐ unencrypted connection ржПрж░ ржоржзрзНржпрзЗ switch ржХрж░рзЗ, ржЕржержмрж╛ ржпржжрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржмрж░рзНрждржорж╛ржи room switch ржХрж░рзЗред рждржмрзЗ, ржпрзЗрж╣рзЗрждрзБ `createConnection` ржПржХржЯрж┐ function, ржЖржкржирж┐ ржЪрзЗржХ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ ржпрзЗ ржПржЯрж┐ ржпрзЗ information ржкржбрж╝рзЗ рждрж╛ *ржЖрж╕рж▓рзЗ* ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛ред ржПржЯрж┐ рж╕ржорж╛ржзрж╛ржи ржХрж░рждрзЗ, `App` component ржерзЗржХрзЗ `createConnection` ржкрж╛рж╕ ржХрж░рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ, raw `roomId` ржПржмржВ `isEncrypted` value ржкрж╛рж╕ ржХрж░рзБржи:

```js {2-3}
      <ChatRoom
        roomId={roomId}
        isEncrypted={isEncrypted}
        onMessage={msg => {
          showNotification('New message: ' + msg, isDark ? 'dark' : 'light');
        }}
      />
```

ржПржЦржи ржЖржкржирж┐ `App` ржерзЗржХрзЗ ржкрж╛рж╕ ржХрж░рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ Effect ржПрж░ *ржнрж┐рждрж░рзЗ* `createConnection` function рж╕рж░рж╛рждрзЗ ржкрж╛рж░рзЗржи:

```js {1-4,6,10-20}
import {
  createEncryptedConnection,
  createUnencryptedConnection,
} from './chat.js';

export default function ChatRoom({ roomId, isEncrypted, onMessage }) {
  const onReceiveMessage = useEffectEvent(onMessage);

  useEffect(() => {
    function createConnection() {
      const options = {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
      if (isEncrypted) {
        return createEncryptedConnection(options);
      } else {
        return createUnencryptedConnection(options);
      }
    }
    // ...
```

ржПржЗ ржжрзБржЯрж┐ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрж░рзЗ, ржЖржкржирж╛рж░ Effect ржЖрж░ ржХрзЛржирзЛ function value ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░рзЗ ржирж╛:

```js {1,8,10,21}
export default function ChatRoom({ roomId, isEncrypted, onMessage }) { // Reactive values
  const onReceiveMessage = useEffectEvent(onMessage); // Not reactive

  useEffect(() => {
    function createConnection() {
      const options = {
        serverUrl: 'https://localhost:1234',
        roomId: roomId // Reading a reactive value
      };
      if (isEncrypted) { // Reading a reactive value
        return createEncryptedConnection(options);
      } else {
        return createUnencryptedConnection(options);
      }
    }

    const connection = createConnection();
    connection.on('message', (msg) => onReceiveMessage(msg));
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, isEncrypted]); // тЬЕ рж╕ржорж╕рзНржд dependency ржбрж┐ржХрзНрж▓рзЗржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
```

ржлрж▓рж╕рзНржмрж░рзВржк, chat рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржкрзБржирж░рж╛ржпрж╝ рж╕ржВржпрзБржХрзНржд рж╣ржпрж╝ ржпржЦржи ржХрж┐ржЫрзБ ржЕрж░рзНржержкрзВрж░рзНржг (`roomId` ржмрж╛ `isEncrypted`) ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣ржпрж╝:


<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js src/App.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';

import { showNotification } from './notifications.js';

export default function App() {
  const [isDark, setIsDark] = useState(false);
  const [roomId, setRoomId] = useState('general');
  const [isEncrypted, setIsEncrypted] = useState(false);

  return (
    <>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <label>
        <input
          type="checkbox"
          checked={isEncrypted}
          onChange={e => setIsEncrypted(e.target.checked)}
        />
        Enable encryption
      </label>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        isEncrypted={isEncrypted}
        onMessage={msg => {
          showNotification('New message: ' + msg, isDark ? 'dark' : 'light');
        }}
      />
    </>
  );
}
```

```js src/ChatRoom.js active
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import {
  createEncryptedConnection,
  createUnencryptedConnection,
} from './chat.js';

export default function ChatRoom({ roomId, isEncrypted, onMessage }) {
  const onReceiveMessage = useEffectEvent(onMessage);

  useEffect(() => {
    function createConnection() {
      const options = {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
      if (isEncrypted) {
        return createEncryptedConnection(options);
      } else {
        return createUnencryptedConnection(options);
      }
    }

    const connection = createConnection();
    connection.on('message', (msg) => onReceiveMessage(msg));
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, isEncrypted]);

  return <h1>Welcome to the {roomId} room!</h1>;
}
```

```js src/chat.js
export function createEncryptedConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  let intervalId;
  let messageCallback;
  return {
    connect() {
      console.log('тЬЕ ЁЯФР Connecting to "' + roomId + '" room... (encrypted)');
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        if (messageCallback) {
          if (Math.random() > 0.5) {
            messageCallback('hey')
          } else {
            messageCallback('lol');
          }
        }
      }, 3000);
    },
    disconnect() {
      clearInterval(intervalId);
      messageCallback = null;
      console.log('тЭМ ЁЯФР Disconnected from "' + roomId + '" room (encrypted)');
    },
    on(event, callback) {
      if (messageCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'message') {
        throw Error('Only "message" event is supported.');
      }
      messageCallback = callback;
    },
  };
}

export function createUnencryptedConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  let intervalId;
  let messageCallback;
  return {
    connect() {
      console.log('тЬЕ Connecting to "' + roomId + '" room (unencrypted)...');
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        if (messageCallback) {
          if (Math.random() > 0.5) {
            messageCallback('hey')
          } else {
            messageCallback('lol');
          }
        }
      }, 3000);
    },
    disconnect() {
      clearInterval(intervalId);
      messageCallback = null;
      console.log('тЭМ Disconnected from "' + roomId + '" room (unencrypted)');
    },
    on(event, callback) {
      if (messageCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'message') {
        throw Error('Only "message" event is supported.');
      }
      messageCallback = callback;
    },
  };
}
```

```js src/notifications.js
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label, button { display: block; margin-bottom: 5px; }
```

</Sandpack>

</Solution>

</Challenges>
